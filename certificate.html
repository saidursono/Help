<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>à¦¸à¦¾à¦°à§à¦Ÿà¦¿à¦«à¦¿à¦•à§‡à¦Ÿ à¦“ ID à¦•à¦¾à¦°à§à¦¡ â€” à¦¸à¦®à¦¾à¦œ à¦•à¦²à§à¦¯à¦¾à¦£ à¦¯à§à¦¬ à¦¸à¦‚à¦—à¦ à¦¨</title>
<link href="https://fonts.googleapis.com/css2?family=Hind+Siliguri:wght@300;400;500;600;700&family=Playfair+Display:wght@400;600;700;900&family=Cinzel:wght@400;600;700&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<style>
:root{
  --g1:#061a06;--g2:#0d2e0d;--g3:#1b6b1b;--g4:#2e8b2e;--g5:#43a843;
  --gold:#f0b429;--sgold:#ffd966;--dgold:#c8940a;--lgold:#fff3cd;
  --glass:rgba(255,255,255,0.07);--glass2:rgba(255,255,255,0.12);
  --b1:rgba(255,255,255,0.15);--b2:rgba(240,180,41,0.35);
  --blur:blur(18px);--text:#e8f5e8;--text2:#a5d6a7;
}
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:'Hind Siliguri',sans-serif;background:var(--g1);color:var(--text);min-height:100vh;overflow-x:hidden;}
body::before{content:'';position:fixed;inset:0;z-index:0;pointer-events:none;
  background:radial-gradient(ellipse 70% 60% at 15% 20%,rgba(46,139,46,.28),transparent 65%),
    radial-gradient(ellipse 55% 70% at 85% 75%,rgba(27,107,27,.22),transparent 65%);}
.orb{position:fixed;border-radius:50%;pointer-events:none;z-index:0;}
.o1{width:420px;height:420px;top:-120px;right:-120px;background:radial-gradient(circle,rgba(240,180,41,.1),transparent 70%);animation:ofl 22s ease-in-out infinite;}
.o2{width:320px;height:320px;bottom:-100px;left:-100px;background:radial-gradient(circle,rgba(46,139,46,.18),transparent 70%);animation:ofl 28s ease-in-out infinite reverse;}
@keyframes ofl{0%,100%{transform:translateY(0)}40%{transform:translateY(-30px)}70%{transform:translateY(15px)}}
@keyframes spin{to{transform:rotate(360deg)}}
@keyframes fu{from{transform:translateY(24px);opacity:0}to{transform:translateY(0);opacity:1}}
@keyframes shimmer{0%{background-position:-200% 0}100%{background-position:200% 0}}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:.5}}

/* LOADER */
#loader{position:fixed;inset:0;z-index:9999;background:var(--g1);display:flex;flex-direction:column;align-items:center;justify-content:center;transition:opacity .5s;}
.ld-ring{width:64px;height:64px;border-radius:50%;border:3px solid rgba(255,215,102,.15);border-top:3px solid var(--sgold);animation:spin .85s linear infinite;}
.ld-txt{color:var(--sgold);margin-top:14px;font-size:13px;opacity:.65;}

/* NAV */
nav{position:fixed;top:0;left:0;right:0;z-index:1000;background:rgba(6,26,6,.9);backdrop-filter:var(--blur);border-bottom:1px solid var(--b2);box-shadow:0 4px 30px rgba(0,0,0,.35);}
.nav-in{max-width:1200px;margin:0 auto;display:flex;align-items:center;justify-content:space-between;height:64px;padding:0 24px;}
.brand{display:flex;align-items:center;gap:12px;cursor:pointer;text-decoration:none;}
.brand-ico{width:42px;height:42px;border-radius:50%;overflow:hidden;border:2px solid var(--gold);}
.brand-ico img{width:100%;height:100%;object-fit:cover;}
.brand-txt{color:var(--sgold);font-size:13px;font-weight:700;line-height:1.3;}
.brand-txt span{display:block;color:var(--text2);font-size:10px;font-weight:400;}
.nav-right{display:flex;align-items:center;gap:10px;}
.nav-back{padding:8px 16px;border-radius:8px;background:var(--glass2);border:1px solid var(--b1);color:var(--sgold);font-size:13px;font-weight:600;cursor:pointer;text-decoration:none;transition:all .2s;}
.nav-back:hover{background:rgba(240,180,41,.15);}
.nav-user{display:flex;align-items:center;gap:8px;padding:6px 12px;background:rgba(240,180,41,.1);border:1px solid var(--b2);border-radius:8px;}
.nav-av{width:28px;height:28px;border-radius:50%;border:2px solid var(--gold);overflow:hidden;background:var(--g3);display:flex;align-items:center;justify-content:center;font-size:12px;font-weight:700;}
.nav-av img{width:100%;height:100%;object-fit:cover;}
.nav-name{color:var(--sgold);font-size:13px;font-weight:600;}

/* PAGE HEADER */
.page-header{padding:90px 20px 40px;text-align:center;position:relative;z-index:1;}
.ph-badge{display:inline-block;padding:6px 20px;border-radius:20px;background:rgba(240,180,41,.1);border:1px solid rgba(240,180,41,.3);color:var(--sgold);font-size:13px;margin-bottom:16px;}
.ph-title{font-size:clamp(2rem,5vw,3rem);font-weight:700;color:var(--sgold);margin-bottom:8px;}
.ph-sub{color:var(--text2);font-size:15px;}
.ph-bar{width:70px;height:3px;background:linear-gradient(90deg,var(--gold),var(--sgold));margin:16px auto 0;border-radius:2px;}

/* NOT LOGGED IN */
#notLoggedIn{position:relative;z-index:1;max-width:500px;margin:0 auto;padding:40px 20px;text-align:center;display:none;}
.nli-box{background:rgba(13,46,13,.9);backdrop-filter:var(--blur);border:1px solid var(--b2);border-radius:24px;padding:48px 36px;}
.nli-ico{font-size:4rem;margin-bottom:16px;}
.nli-box h3{color:var(--sgold);font-size:1.4rem;font-weight:700;margin-bottom:10px;}
.nli-box p{color:rgba(255,255,255,.65);font-size:14px;line-height:1.8;margin-bottom:24px;}
.btn-login{display:inline-block;padding:14px 36px;background:linear-gradient(135deg,var(--gold),var(--sgold));color:var(--g1);border-radius:12px;font-size:15px;font-weight:700;text-decoration:none;transition:all .3s;}
.btn-login:hover{transform:translateY(-3px);box-shadow:0 8px 30px rgba(240,180,41,.5);}

/* MAIN CONTENT */
#mainContent{position:relative;z-index:1;max-width:1100px;margin:0 auto;padding:0 20px 60px;display:none;}

/* USER INFO CARD */
.user-card{background:rgba(13,46,13,.7);backdrop-filter:var(--blur);border:1px solid var(--b2);border-radius:20px;padding:24px 28px;margin-bottom:32px;display:flex;align-items:center;gap:20px;animation:fu .6s ease both;}
.user-big-av{width:80px;height:80px;border-radius:50%;border:3px solid var(--gold);overflow:hidden;background:linear-gradient(135deg,var(--g3),var(--g5));display:flex;align-items:center;justify-content:center;font-size:2rem;font-weight:700;flex-shrink:0;box-shadow:0 0 20px rgba(240,180,41,.3);}
.user-big-av img{width:100%;height:100%;object-fit:cover;}
.user-details h2{color:var(--sgold);font-size:1.3rem;font-weight:700;margin-bottom:4px;}
.user-details p{color:var(--text2);font-size:13px;}
.user-badge{display:inline-block;margin-top:8px;padding:3px 14px;border-radius:20px;background:rgba(240,180,41,.12);border:1px solid rgba(240,180,41,.28);color:var(--sgold);font-size:12px;font-weight:600;}
.user-status-ok{margin-left:auto;text-align:right;}
.status-dot{width:10px;height:10px;border-radius:50%;background:#4caf50;display:inline-block;margin-right:6px;animation:pulse 2s infinite;}
.status-txt{color:#81c784;font-size:13px;font-weight:600;}

/* SECTION TABS */
.cert-tabs{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:28px;animation:fu .6s .1s ease both;opacity:0;animation-fill-mode:forwards;}
.ctab{padding:10px 20px;border-radius:12px;cursor:pointer;border:1px solid var(--b1);background:var(--glass);color:var(--text2);font-family:inherit;font-size:13px;font-weight:600;transition:all .25s;}
.ctab.active,.ctab:hover{background:rgba(240,180,41,.15);border-color:var(--b2);color:var(--sgold);}
.ctab.active{background:linear-gradient(135deg,rgba(240,180,41,.2),rgba(240,180,41,.08));}

/* CERT SECTIONS */
.cert-section{display:none;animation:fu .5s ease both;}
.cert-section.active{display:block;}

/* SECTION HEADER */
.sec-hdr{text-align:center;margin-bottom:28px;}
.sec-hdr h3{color:var(--sgold);font-size:1.4rem;font-weight:700;margin-bottom:6px;}
.sec-hdr p{color:var(--text2);font-size:14px;}

/* CERTIFICATE PREVIEW BOX */
.cert-preview-wrap{background:rgba(13,46,13,.5);backdrop-filter:var(--blur);border:1px solid var(--b1);border-radius:20px;padding:28px;margin-bottom:20px;}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CERTIFICATE DESIGNS (Canvas-based preview)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.cert-canvas-wrap{display:flex;justify-content:center;margin-bottom:20px;}
canvas.cert-canvas{max-width:100%;border-radius:12px;box-shadow:0 20px 60px rgba(0,0,0,.5),0 0 40px rgba(240,180,41,.15);border:2px solid rgba(240,180,41,.3);}

/* DOWNLOAD BUTTONS */
.dl-btns{display:flex;gap:12px;justify-content:center;flex-wrap:wrap;}
.dl-btn{display:flex;align-items:center;gap:8px;padding:12px 24px;border-radius:12px;font-size:14px;font-weight:700;cursor:pointer;border:none;font-family:inherit;transition:all .3s;}
.dl-pdf{background:linear-gradient(135deg,#e53935,#c62828);color:#fff;box-shadow:0 4px 20px rgba(229,57,53,.3);}
.dl-pdf:hover{transform:translateY(-3px);box-shadow:0 8px 30px rgba(229,57,53,.5);}
.dl-jpg{background:linear-gradient(135deg,var(--gold),var(--sgold));color:var(--g1);box-shadow:0 4px 20px rgba(240,180,41,.3);}
.dl-jpg:hover{transform:translateY(-3px);box-shadow:0 8px 30px rgba(240,180,41,.5);}
.dl-btn:disabled{opacity:.5;cursor:not-allowed;transform:none!important;}

/* INFO GRID */
.cert-info-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:14px;margin-top:20px;}
.cert-info-item{padding:14px 16px;background:var(--glass);border:1px solid var(--b1);border-radius:12px;display:flex;align-items:center;gap:10px;}
.cert-info-ico{font-size:1.1rem;}
.cert-info-txt strong{display:block;color:var(--sgold);font-size:11px;margin-bottom:2px;}
.cert-info-txt span{color:rgba(255,255,255,.8);font-size:13px;}

/* PENDING MESSAGE */
.pending-cert{text-align:center;padding:48px 24px;background:rgba(255,193,7,.06);border:1px solid rgba(255,193,7,.2);border-radius:20px;}
.pending-cert .ico{font-size:3.5rem;margin-bottom:14px;}
.pending-cert h4{color:#ffd54f;font-size:1.2rem;font-weight:700;margin-bottom:8px;}
.pending-cert p{color:rgba(255,255,255,.6);font-size:14px;line-height:1.8;}

/* FOOTER */
footer{background:rgba(4,15,4,.85);backdrop-filter:var(--blur);border-top:1px solid var(--b2);padding:24px 20px;text-align:center;position:relative;z-index:1;}
.ft-c{color:rgba(255,255,255,.25);font-size:12px;}
.ft-dev{color:rgba(255,215,0,.5);font-size:12px;font-weight:600;}

@media(max-width:640px){
  .user-card{flex-direction:column;text-align:center;}
  .user-status-ok{margin-left:0;text-align:center;}
  .cert-tabs{justify-content:center;}
}
</style>
</head>
<body>
<div class="orb o1"></div><div class="orb o2"></div>

<!-- LOADER -->
<div id="loader"><div class="ld-ring"></div><div class="ld-txt">à¦²à§‹à¦¡ à¦¹à¦šà§à¦›à§‡...</div></div>

<!-- NAV -->
<nav>
  <div class="nav-in">
    <a class="brand" href="index.html">
      <div class="brand-ico"><img src="https://i.ibb.co.com/XZF23TDY/received-895949380028820.jpg" alt="à¦²à§‹à¦—à§‹"></div>
      <div class="brand-txt">à¦¸à¦®à¦¾à¦œ à¦•à¦²à§à¦¯à¦¾à¦£ à¦¯à§à¦¬ à¦¸à¦‚à¦—à¦ à¦¨<span>Somaj Kalyan Jubo Sangathan</span></div>
    </a>
    <div class="nav-right">
      <a class="nav-back" href="index.html">â† à¦®à§‚à¦² à¦ªà§‡à¦œ</a>
      <div class="nav-user" id="navUser" style="display:none">
        <div class="nav-av" id="navAv"></div>
        <span class="nav-name" id="navName">...</span>
      </div>
    </div>
  </div>
</nav>

<!-- PAGE HEADER -->
<div class="page-header">
  <div class="ph-badge">ğŸ† à¦¸à¦¾à¦°à§à¦Ÿà¦¿à¦«à¦¿à¦•à§‡à¦Ÿ à¦ªà§‹à¦°à§à¦Ÿà¦¾à¦²</div>
  <h1 class="ph-title">à¦¸à¦¾à¦°à§à¦Ÿà¦¿à¦«à¦¿à¦•à§‡à¦Ÿ à¦“ ID à¦•à¦¾à¦°à§à¦¡</h1>
  <p class="ph-sub">Certificates & Identity Card â€” à¦¸à¦®à¦¾à¦œ à¦•à¦²à§à¦¯à¦¾à¦£ à¦¯à§à¦¬ à¦¸à¦‚à¦—à¦ à¦¨</p>
  <div class="ph-bar"></div>
</div>

<!-- NOT LOGGED IN -->
<div id="notLoggedIn">
  <div class="nli-box">
    <div class="nli-ico">ğŸ”</div>
    <h3>à¦²à¦—à¦‡à¦¨ à¦•à¦°à§à¦¨</h3>
    <p>à¦¸à¦¾à¦°à§à¦Ÿà¦¿à¦«à¦¿à¦•à§‡à¦Ÿ à¦“ ID à¦•à¦¾à¦°à§à¦¡ à¦¦à§‡à¦–à¦¤à§‡ à¦à¦¬à¦‚ à¦¡à¦¾à¦‰à¦¨à¦²à§‹à¦¡ à¦•à¦°à¦¤à§‡ à¦†à¦ªà¦¨à¦¾à¦•à§‡ à¦²à¦—à¦‡à¦¨ à¦•à¦°à¦¤à§‡ à¦¹à¦¬à§‡à¥¤</p>
    <a href="login.html" class="btn-login">ğŸ” à¦²à¦—à¦‡à¦¨ à¦•à¦°à§à¦¨</a>
  </div>
</div>

<!-- MAIN CONTENT -->
<div id="mainContent">
  <!-- User Info Card -->
  <div class="user-card" id="userCard">
    <div class="user-big-av" id="bigAv"></div>
    <div class="user-details">
      <h2 id="uName">-</h2>
      <p id="uInfo">-</p>
      <span class="user-badge" id="uBadge">à¦¸à¦¦à¦¸à§à¦¯</span>
    </div>
    <div class="user-status-ok">
      <div><span class="status-dot"></span><span class="status-txt">à¦…à¦¨à§à¦®à§‹à¦¦à¦¿à¦¤ à¦¸à¦¦à¦¸à§à¦¯</span></div>
      <div style="color:var(--text2);font-size:12px;margin-top:4px" id="uId"></div>
    </div>
  </div>

  <!-- TABS -->
  <div class="cert-tabs">
    <button class="ctab active" onclick="showCert('membership',this)">ğŸ… à¦¸à¦¦à¦¸à§à¦¯à¦ªà¦¦ à¦¸à¦¾à¦°à§à¦Ÿà¦¿à¦«à¦¿à¦•à§‡à¦Ÿ</button>
    <button class="ctab" onclick="showCert('idcard',this)">ğŸªª ID à¦•à¦¾à¦°à§à¦¡</button>
    <button class="ctab" onclick="showCert('volunteer',this)">ğŸ™‹ à¦¸à§à¦¬à§‡à¦šà§à¦›à¦¾à¦¸à§‡à¦¬à§€ à¦¸à¦¾à¦°à§à¦Ÿà¦¿à¦«à¦¿à¦•à§‡à¦Ÿ</button>
    <button class="ctab" onclick="showCert('participation',this)">ğŸ¯ à¦…à¦‚à¦¶à¦—à§à¦°à¦¹à¦£ à¦¸à¦¾à¦°à§à¦Ÿà¦¿à¦«à¦¿à¦•à§‡à¦Ÿ</button>
  </div>

  <!-- â•â• MEMBERSHIP CERTIFICATE â•â• -->
  <div class="cert-section active" id="sec-membership">
    <div class="sec-hdr">
      <h3>ğŸ… à¦¸à¦¦à¦¸à§à¦¯à¦ªà¦¦ à¦¸à¦¾à¦°à§à¦Ÿà¦¿à¦«à¦¿à¦•à§‡à¦Ÿ</h3>
      <p>Membership Certificate â€” à¦¸à¦®à¦¾à¦œ à¦•à¦²à§à¦¯à¦¾à¦£ à¦¯à§à¦¬ à¦¸à¦‚à¦—à¦ à¦¨</p>
    </div>
    <div class="cert-preview-wrap">
      <div class="cert-canvas-wrap">
        <canvas id="membershipCanvas" class="cert-canvas" width="1122" height="794"></canvas>
      </div>
      <div class="dl-btns">
        <button class="dl-btn dl-pdf" onclick="downloadCert('membership','pdf')">ğŸ“„ PDF à¦¡à¦¾à¦‰à¦¨à¦²à§‹à¦¡</button>
        <button class="dl-btn dl-jpg" onclick="downloadCert('membership','jpg')">ğŸ–¼ï¸ JPG à¦¡à¦¾à¦‰à¦¨à¦²à§‹à¦¡</button>
      </div>
    </div>
    <div class="cert-info-grid" id="membershipInfo"></div>
  </div>

  <!-- â•â• ID CARD â•â• -->
  <div class="cert-section" id="sec-idcard">
    <div class="sec-hdr">
      <h3>ğŸªª à¦ªà¦°à¦¿à¦šà¦¯à¦¼à¦ªà¦¤à§à¦° (ID à¦•à¦¾à¦°à§à¦¡)</h3>
      <p>Identity Card â€” à¦¸à¦®à¦¾à¦œ à¦•à¦²à§à¦¯à¦¾à¦£ à¦¯à§à¦¬ à¦¸à¦‚à¦—à¦ à¦¨</p>
    </div>
    <div class="cert-preview-wrap">
      <div class="cert-canvas-wrap">
        <canvas id="idCanvas" class="cert-canvas" width="856" height="540"></canvas>
      </div>
      <div class="dl-btns">
        <button class="dl-btn dl-pdf" onclick="downloadCert('idcard','pdf')">ğŸ“„ PDF à¦¡à¦¾à¦‰à¦¨à¦²à§‹à¦¡</button>
        <button class="dl-btn dl-jpg" onclick="downloadCert('idcard','jpg')">ğŸ–¼ï¸ JPG à¦¡à¦¾à¦‰à¦¨à¦²à§‹à¦¡</button>
      </div>
    </div>
    <div class="cert-info-grid" id="idInfo"></div>
  </div>

  <!-- â•â• VOLUNTEER CERTIFICATE â•â• -->
  <div class="cert-section" id="sec-volunteer">
    <div class="sec-hdr">
      <h3>ğŸ™‹ à¦¸à§à¦¬à§‡à¦šà§à¦›à¦¾à¦¸à§‡à¦¬à§€ à¦¸à¦¾à¦°à§à¦Ÿà¦¿à¦«à¦¿à¦•à§‡à¦Ÿ</h3>
      <p>Volunteer Certificate â€” à¦¸à¦®à¦¾à¦œ à¦•à¦²à§à¦¯à¦¾à¦£ à¦¯à§à¦¬ à¦¸à¦‚à¦—à¦ à¦¨</p>
    </div>
    <div class="cert-preview-wrap">
      <div class="cert-canvas-wrap">
        <canvas id="volunteerCanvas" class="cert-canvas" width="1122" height="794"></canvas>
      </div>
      <div class="dl-btns">
        <button class="dl-btn dl-pdf" onclick="downloadCert('volunteer','pdf')">ğŸ“„ PDF à¦¡à¦¾à¦‰à¦¨à¦²à§‹à¦¡</button>
        <button class="dl-btn dl-jpg" onclick="downloadCert('volunteer','jpg')">ğŸ–¼ï¸ JPG à¦¡à¦¾à¦‰à¦¨à¦²à§‹à¦¡</button>
      </div>
    </div>
  </div>

  <!-- â•â• PARTICIPATION CERTIFICATE â•â• -->
  <div class="cert-section" id="sec-participation">
    <div class="sec-hdr">
      <h3>ğŸ¯ à¦…à¦‚à¦¶à¦—à§à¦°à¦¹à¦£ à¦¸à¦¾à¦°à§à¦Ÿà¦¿à¦«à¦¿à¦•à§‡à¦Ÿ</h3>
      <p>Participation Certificate â€” à¦¸à¦®à¦¾à¦œ à¦•à¦²à§à¦¯à¦¾à¦£ à¦¯à§à¦¬ à¦¸à¦‚à¦—à¦ à¦¨</p>
    </div>
    <div class="cert-preview-wrap">
      <div class="cert-canvas-wrap">
        <canvas id="participationCanvas" class="cert-canvas" width="1122" height="794"></canvas>
      </div>
      <div class="dl-btns">
        <button class="dl-btn dl-pdf" onclick="downloadCert('participation','pdf')">ğŸ“„ PDF à¦¡à¦¾à¦‰à¦¨à¦²à§‹à¦¡</button>
        <button class="dl-btn dl-jpg" onclick="downloadCert('participation','jpg')">ğŸ–¼ï¸ JPG à¦¡à¦¾à¦‰à¦¨à¦²à§‹à¦¡</button>
      </div>
    </div>
  </div>
</div>

<footer>
  <div class="ft-c">Â© à§¨à§¦à§¨à§«â€“à§¨à§¦à§¨à§¬ à¦¸à¦®à¦¾à¦œ à¦•à¦²à§à¦¯à¦¾à¦£ à¦¯à§à¦¬ à¦¸à¦‚à¦—à¦ à¦¨ Â· à¦°à¦¾à¦®à¦•à§ƒà¦·à§à¦£à¦ªà§à¦°, à¦¦à§Œà¦²à¦¤à¦ªà§à¦°, à¦•à§à¦·à§à¦Ÿà¦¿à¦¯à¦¼à¦¾</div>
  <div style="margin-top:6px"><span class="ft-dev">ğŸ› ï¸ Developed by <a href="https://saidursono.github.io/Saidur/" target="_blank" style="color:rgba(255,215,0,.7);text-decoration:none">Saidur</a></span></div>
</footer>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     JAVASCRIPT â€” Canvas Drawing & Firebase
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<script>
let _member = null;
let _photoImg = null;

/* â•â• TAB SWITCHING â•â• */
function showCert(id, btn) {
  document.querySelectorAll('.cert-section').forEach(s => s.classList.remove('active'));
  document.querySelectorAll('.ctab').forEach(b => b.classList.remove('active'));
  document.getElementById('sec-' + id).classList.add('active');
  if (btn) btn.classList.add('active');
  // Redraw canvas when tab shown
  if (_member) {
    setTimeout(() => {
      if (id === 'membership') drawMembership(_member, _photoImg);
      else if (id === 'idcard') drawIDCard(_member, _photoImg);
      else if (id === 'volunteer') drawVolunteer(_member, _photoImg);
      else if (id === 'participation') drawParticipation(_member, _photoImg);
    }, 50);
  }
}

/* â•â• HELPER â•â• */
function bnNum(n) { return n.toString().replace(/\d/g, d => 'à§¦à§§à§¨à§©à§ªà§«à§¬à§­à§®à§¯'[d]); }
function ini(nm) { return (nm || '?').replace('à¦®à§‹à¦ƒ ', '').replace('à¦®à§‹à¦›à¦¾à¦ƒ ', '').trim().charAt(0); }
function today() {
  const d = new Date();
  return `${bnNum(d.getDate())} ${['à¦œà¦¾à¦¨à§à¦¯à¦¼à¦¾à¦°à¦¿','à¦«à§‡à¦¬à§à¦°à§à¦¯à¦¼à¦¾à¦°à¦¿','à¦®à¦¾à¦°à§à¦š','à¦à¦ªà§à¦°à¦¿à¦²','à¦®à§‡','à¦œà§à¦¨','à¦œà§à¦²à¦¾à¦‡','à¦†à¦—à¦¸à§à¦Ÿ','à¦¸à§‡à¦ªà§à¦Ÿà§‡à¦®à§à¦¬à¦°','à¦…à¦•à§à¦Ÿà§‹à¦¬à¦°','à¦¨à¦­à§‡à¦®à§à¦¬à¦°','à¦¡à¦¿à¦¸à§‡à¦®à§à¦¬à¦°'][d.getMonth()]} ${bnNum(d.getFullYear())}`;
}
function todayEn() {
  const d = new Date();
  return d.toLocaleDateString('en-GB', { day: 'numeric', month: 'long', year: 'numeric' });
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   DRAW MEMBERSHIP CERTIFICATE (A4 Landscape 1122Ã—794)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function drawMembership(m, photo) {
  const canvas = document.getElementById('membershipCanvas');
  const c = canvas.getContext('2d');
  const W = 1122, H = 794;
  c.clearRect(0, 0, W, H);

  // Background â€” cream parchment
  c.fillStyle = '#fffef5';
  c.fillRect(0, 0, W, H);

  // Decorative background pattern
  c.save();
  c.globalAlpha = 0.03;
  for (let i = 0; i < W; i += 40) {
    for (let j = 0; j < H; j += 40) {
      c.fillStyle = '#b8860b';
      c.font = '20px serif';
      c.fillText('âœ¦', i, j);
    }
  }
  c.restore();

  // Outer gold border
  const grd = c.createLinearGradient(0, 0, W, H);
  grd.addColorStop(0, '#b8860b');
  grd.addColorStop(0.25, '#ffd700');
  grd.addColorStop(0.5, '#daa520');
  grd.addColorStop(0.75, '#ffd700');
  grd.addColorStop(1, '#b8860b');

  c.strokeStyle = grd;
  c.lineWidth = 14;
  c.strokeRect(7, 7, W - 14, H - 14);

  // Inner border
  c.strokeStyle = grd;
  c.lineWidth = 3;
  c.strokeRect(22, 22, W - 44, H - 44);

  // Corner ornaments
  drawCornerOrnament(c, 28, 28, grd);
  drawCornerOrnament(c, W - 28, 28, grd, true);
  drawCornerOrnament(c, 28, H - 28, grd, false, true);
  drawCornerOrnament(c, W - 28, H - 28, grd, true, true);

  // Left green accent bar
  const gBar = c.createLinearGradient(0, 0, 0, H);
  gBar.addColorStop(0, '#1b6b1b');
  gBar.addColorStop(0.5, '#2e8b2e');
  gBar.addColorStop(1, '#1b6b1b');
  c.fillStyle = gBar;
  c.fillRect(36, 36, 8, H - 72);

  // Right green accent bar
  c.fillStyle = gBar;
  c.fillRect(W - 44, 36, 8, H - 72);

  // Header area background
  const hGrd = c.createLinearGradient(0, 36, 0, 180);
  hGrd.addColorStop(0, 'rgba(27,107,27,0.08)');
  hGrd.addColorStop(1, 'rgba(27,107,27,0)');
  c.fillStyle = hGrd;
  c.fillRect(52, 36, W - 104, 144);

  // Logo circle placeholder (left top)
  c.save();
  c.beginPath();
  c.arc(120, 105, 52, 0, Math.PI * 2);
  c.fillStyle = '#1b6b1b';
  c.fill();
  c.strokeStyle = grd;
  c.lineWidth = 3;
  c.stroke();
  c.restore();
  // Logo text
  c.fillStyle = '#ffd700';
  c.font = 'bold 11px Arial';
  c.textAlign = 'center';
  c.textBaseline = 'middle';
  c.fillText('à¦¸à¦‚à¦—à¦ à¦¨', 120, 100);
  c.fillText('à¦²à§‹à¦—à§‹', 120, 115);

  // Organization name header (center)
  c.textAlign = 'center';
  c.textBaseline = 'alphabetic';
  c.fillStyle = '#1b6b1b';
  c.font = 'bold 32px "Hind Siliguri", serif';
  c.fillText('à¦¸à¦®à¦¾à¦œ à¦•à¦²à§à¦¯à¦¾à¦£ à¦¯à§à¦¬ à¦¸à¦‚à¦—à¦ à¦¨', W / 2, 80);

  c.fillStyle = '#8b6914';
  c.font = 'italic 14px Georgia';
  c.fillText('Somaj Kalyan Jubo Sangathan', W / 2, 100);

  c.fillStyle = '#555';
  c.font = '12px Arial';
  c.fillText('à¦°à¦¾à¦®à¦•à§ƒà¦·à§à¦£à¦ªà§à¦°, à¦¦à§Œà¦²à¦¤à¦ªà§à¦°, à¦•à§à¦·à§à¦Ÿà¦¿à¦¯à¦¼à¦¾  Â·  Est. 2025', W / 2, 118);

  // Divider line with ornament
  c.strokeStyle = grd;
  c.lineWidth = 1.5;
  c.beginPath();
  c.moveTo(60, 138);
  c.lineTo(W / 2 - 60, 138);
  c.stroke();
  c.fillStyle = '#b8860b';
  c.font = '20px serif';
  c.textAlign = 'center';
  c.fillText('â–', W / 2, 143);
  c.beginPath();
  c.moveTo(W / 2 + 60, 138);
  c.lineTo(W - 60, 138);
  c.stroke();

  // Certificate title
  c.fillStyle = '#1a1200';
  c.font = 'bold 42px "Cinzel", "Playfair Display", serif';
  c.textAlign = 'center';
  c.fillText('CERTIFICATE OF MEMBERSHIP', W / 2, 195);

  c.fillStyle = '#8b6914';
  c.font = 'bold 22px "Hind Siliguri"';
  c.fillText('à¦¸à¦¦à¦¸à§à¦¯à¦ªà¦¦ à¦¸à¦¾à¦°à§à¦Ÿà¦¿à¦«à¦¿à¦•à§‡à¦Ÿ', W / 2, 225);

  // Decorative line under title
  const tLine = c.createLinearGradient(200, 0, W - 200, 0);
  tLine.addColorStop(0, 'transparent');
  tLine.addColorStop(0.2, '#b8860b');
  tLine.addColorStop(0.5, '#ffd700');
  tLine.addColorStop(0.8, '#b8860b');
  tLine.addColorStop(1, 'transparent');
  c.strokeStyle = tLine;
  c.lineWidth = 2;
  c.beginPath();
  c.moveTo(200, 238);
  c.lineTo(W - 200, 238);
  c.stroke();

  // Photo circle (right side)
  const pX = W - 148, pY = 380, pR = 82;
  c.save();
  c.beginPath();
  c.arc(pX, pY, pR, 0, Math.PI * 2);
  c.clip();
  if (photo) {
    c.drawImage(photo, pX - pR, pY - pR, pR * 2, pR * 2);
  } else {
    c.fillStyle = '#e8f5e8';
    c.fillRect(pX - pR, pY - pR, pR * 2, pR * 2);
    c.fillStyle = '#1b6b1b';
    c.font = `bold 64px "Hind Siliguri"`;
    c.textAlign = 'center';
    c.textBaseline = 'middle';
    c.fillText(ini(m.name), pX, pY + 4);
  }
  c.restore();
  c.strokeStyle = grd;
  c.lineWidth = 4;
  c.beginPath();
  c.arc(pX, pY, pR + 2, 0, Math.PI * 2);
  c.stroke();
  // Second ring
  c.strokeStyle = 'rgba(184,134,11,0.3)';
  c.lineWidth = 2;
  c.beginPath();
  c.arc(pX, pY, pR + 12, 0, Math.PI * 2);
  c.stroke();

  // Main text body
  const lx = 80;
  c.textAlign = 'left';
  c.textBaseline = 'alphabetic';
  c.fillStyle = '#3a3a3a';
  c.font = '16px "Hind Siliguri"';
  c.fillText('à¦à¦Ÿà¦¿ à¦ªà§à¦°à¦®à¦¾à¦£ à¦•à¦°à¦¾ à¦¹à¦šà§à¦›à§‡ à¦¯à§‡,', lx, 278);
  c.fillText('This is to certify that,', lx, 298);

  // Member name â€” big
  c.fillStyle = '#1b6b1b';
  c.font = 'bold 36px "Hind Siliguri"';
  c.fillText(m.name || '-', lx, 352);
  // Underline
  const nWidth = c.measureText(m.name || '-').width;
  c.strokeStyle = grd;
  c.lineWidth = 2;
  c.beginPath();
  c.moveTo(lx, 358);
  c.lineTo(lx + nWidth, 358);
  c.stroke();

  c.fillStyle = '#444';
  c.font = '15px "Hind Siliguri"';
  c.fillText(`à¦ªà§‡à¦¶à¦¾ / Occupation: ${m.job || 'â€”'}`, lx, 388);
  c.fillText(`à¦¶à¦¿à¦•à§à¦·à¦¾ / Education: ${m.education || 'â€”'}`, lx, 413);
  c.fillText(`à¦—à§à¦°à¦¾à¦® / Village: ${m.area || m.village || 'â€”'}`, lx, 438);
  c.fillText(`à¦®à§‹à¦¬à¦¾à¦‡à¦² / Mobile: ${m.phone || 'â€”'}`, lx, 463);
  c.fillText(`à¦°à¦•à§à¦¤à§‡à¦° à¦—à§à¦°à§à¦ª / Blood Group: ${m.bloodGroup || 'â€”'}`, lx, 488);

  // Main paragraph
  c.fillStyle = '#333';
  c.font = '14px "Hind Siliguri"';
  const mainText = `à¦¸à¦®à¦¾à¦œ à¦•à¦²à§à¦¯à¦¾à¦£ à¦¯à§à¦¬ à¦¸à¦‚à¦—à¦ à¦¨à§‡à¦° à¦à¦•à¦œà¦¨ à¦¨à¦¿à¦¬à§‡à¦¦à¦¿à¦¤à¦ªà§à¦°à¦¾à¦£ à¦¸à¦¦à¦¸à§à¦¯ à¦¹à¦¿à¦¸à§‡à¦¬à§‡ à¦¸à§à¦¬à§€à¦•à§ƒà¦¤ à¦à¦¬à¦‚ à¦¸à¦‚à¦—à¦ à¦¨à§‡à¦° à¦¸à¦•à¦² à¦•à¦¾à¦°à§à¦¯à¦•à§à¦°à¦®à§‡ à¦¸à¦•à§à¦°à¦¿à¦¯à¦¼à¦­à¦¾à¦¬à§‡ à¦…à¦‚à¦¶à¦—à§à¦°à¦¹à¦£ à¦•à¦°à§‡à¦¨à¥¤`;
  wrapText(c, mainText, lx, 518, 580, 22);

  const enText = `is recognized as a dedicated member of Somaj Kalyan Jubo Sangathan and actively participates in all organizational activities.`;
  c.fillStyle = '#555';
  c.font = 'italic 13px Georgia';
  wrapText(c, enText, lx, 546, 580, 20);

  // Member ID & Date
  c.fillStyle = '#1b6b1b';
  c.font = 'bold 15px "Hind Siliguri"';
  c.fillText(`à¦¸à¦¦à¦¸à§à¦¯ à¦¨à¦®à§à¦¬à¦°: ${m.memberId || 'â€”'}`, lx, 598);
  c.fillStyle = '#555';
  c.font = '13px "Hind Siliguri"';
  c.fillText(`à¦¤à¦¾à¦°à¦¿à¦–: ${today()}`, lx, 620);
  c.font = 'italic 13px Georgia';
  c.fillText(`Date: ${todayEn()}`, lx, 638);

  // Signatures
  drawSignature(c, 100, 720, 'à¦¸à¦­à¦¾à¦ªà¦¤à¦¿', 'à¦®à§‹à¦ƒ à¦¶à¦¿à¦®à§à¦² à¦¹à§‹à¦¸à§‡à¦¨', grd);
  drawSignature(c, 400, 720, 'à¦¸à¦¾à¦§à¦¾à¦°à¦£ à¦¸à¦®à§à¦ªà¦¾à¦¦à¦•', 'à¦®à§‹à¦ƒ à¦œà¦¾à¦•à¦¿à¦° à¦¹à§‹à¦¸à§‡à¦¨', grd);
  drawSignature(c, 700, 720, 'à¦¸à¦¾à¦§à¦¾à¦°à¦£ à¦¸à¦®à§à¦ªà¦¾à¦¦à¦•', 'à¦®à§‹à¦ƒ à¦¶à§à¦­ à¦†à¦²à§€', grd);

  // Seal
  drawSeal(c, W - 148, 635, 55, grd);

  // Footer strip
  const footGrd = c.createLinearGradient(0, H - 36, 0, H);
  footGrd.addColorStop(0, '#1b6b1b');
  footGrd.addColorStop(1, '#0d2e0d');
  c.fillStyle = footGrd;
  c.fillRect(52, H - 44, W - 104, 26);
  c.fillStyle = 'rgba(255,215,0,0.9)';
  c.font = '11px "Hind Siliguri"';
  c.textAlign = 'center';
  c.textBaseline = 'middle';
  c.fillText('à¦¸à§‡à¦¬à¦¾à¦¯à¦¼ à¦¨à¦¿à¦¬à§‡à¦¦à¦¿à¦¤, à¦‰à¦¨à§à¦¨à¦¯à¦¼à¦¨à§‡ à¦ªà§à¦°à¦¤à¦¿à¦¶à§à¦°à§à¦¤à¦¿à¦¬à¦¦à§à¦§  Â·  Dedicated to Service, Committed to Development', W / 2, H - 31);

  // Watermark Developer credit
  c.save();
  c.globalAlpha = 0.22;
  c.fillStyle = '#8b6914';
  c.font = 'bold 16px Arial';
  c.textAlign = 'right';
  c.textBaseline = 'bottom';
  c.fillText('Developed by Saidur', W - 60, H - 50);
  c.restore();
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   DRAW ID CARD (856Ã—540 landscape)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function drawIDCard(m, photo) {
  const canvas = document.getElementById('idCanvas');
  const c = canvas.getContext('2d');
  const W = 856, H = 540;
  c.clearRect(0, 0, W, H);

  // Background
  c.fillStyle = '#fffef8';
  c.fillRect(0, 0, W, H);

  // Left green panel
  const lPanel = c.createLinearGradient(0, 0, 180, H);
  lPanel.addColorStop(0, '#061a06');
  lPanel.addColorStop(0.4, '#1b6b1b');
  lPanel.addColorStop(1, '#0d2e0d');
  c.fillStyle = lPanel;
  c.fillRect(0, 0, 200, H);

  // Left panel decorative pattern
  c.save();
  c.globalAlpha = 0.08;
  c.fillStyle = '#ffd700';
  for (let i = 0; i < 200; i += 30) {
    for (let j = 0; j < H; j += 30) {
      c.beginPath();
      c.arc(i, j, 6, 0, Math.PI * 2);
      c.fill();
    }
  }
  c.restore();

  // Gold border
  const grd = c.createLinearGradient(0, 0, W, H);
  grd.addColorStop(0, '#b8860b');
  grd.addColorStop(0.5, '#ffd700');
  grd.addColorStop(1, '#b8860b');
  c.strokeStyle = grd;
  c.lineWidth = 5;
  c.strokeRect(2.5, 2.5, W - 5, H - 5);

  // Photo on left panel
  const pX = 100, pY = 210, pR = 75;
  c.save();
  c.beginPath();
  c.arc(pX, pY, pR, 0, Math.PI * 2);
  c.clip();
  if (photo) {
    c.drawImage(photo, pX - pR, pY - pR, pR * 2, pR * 2);
  } else {
    c.fillStyle = '#2e8b2e';
    c.fillRect(pX - pR, pY - pR, pR * 2, pR * 2);
    c.fillStyle = '#ffd700';
    c.font = 'bold 52px Arial';
    c.textAlign = 'center';
    c.textBaseline = 'middle';
    c.fillText(ini(m.name), pX, pY + 3);
  }
  c.restore();
  c.strokeStyle = grd;
  c.lineWidth = 3.5;
  c.beginPath();
  c.arc(pX, pY, pR + 2, 0, Math.PI * 2);
  c.stroke();

  // Org name on left
  c.fillStyle = '#ffd700';
  c.font = 'bold 13px "Hind Siliguri"';
  c.textAlign = 'center';
  c.textBaseline = 'alphabetic';
  c.fillText('à¦¸à¦®à¦¾à¦œ à¦•à¦²à§à¦¯à¦¾à¦£', 100, 60);
  c.fillText('à¦¯à§à¦¬ à¦¸à¦‚à¦—à¦ à¦¨', 100, 78);
  c.fillStyle = 'rgba(255,215,0,0.55)';
  c.font = '10px Arial';
  c.fillText('Est. 2025', 100, 95);

  // ID tag on left bottom
  c.fillStyle = 'rgba(255,215,0,0.15)';
  c.fillRect(14, H - 80, 172, 50);
  c.fillStyle = '#ffd700';
  c.font = 'bold 11px Arial';
  c.textAlign = 'center';
  c.fillText('à¦ªà¦°à¦¿à¦šà¦¯à¦¼à¦ªà¦¤à§à¦° / ID CARD', 100, H - 56);
  if (m.memberId) {
    c.font = 'bold 14px Arial';
    c.fillStyle = '#ffd966';
    c.fillText(m.memberId, 100, H - 38);
  }

  // Right content area header
  const rHdr = c.createLinearGradient(200, 0, W, 0);
  rHdr.addColorStop(0, 'rgba(27,107,27,0.12)');
  rHdr.addColorStop(1, 'rgba(27,107,27,0)');
  c.fillStyle = rHdr;
  c.fillRect(200, 0, W - 200, 72);

  c.strokeStyle = grd;
  c.lineWidth = 1;
  c.beginPath();
  c.moveTo(200, 72);
  c.lineTo(W, 72);
  c.stroke();

  // Header text
  c.fillStyle = '#1b6b1b';
  c.font = 'bold 18px "Hind Siliguri"';
  c.textAlign = 'left';
  c.fillText('à¦¸à¦®à¦¾à¦œ à¦•à¦²à§à¦¯à¦¾à¦£ à¦¯à§à¦¬ à¦¸à¦‚à¦—à¦ à¦¨', 228, 32);
  c.fillStyle = '#8b6914';
  c.font = '11px Georgia';
  c.fillText('Somaj Kalyan Jubo Sangathan Â· Ramkrisnopur, Doulatpur, Kushtia', 228, 50);

  // Member info rows
  const rx = 228, rows = [
    ['ğŸ‘¤', 'à¦¨à¦¾à¦® / Name', m.name || '-'],
    ['ğŸ“', 'à¦—à§à¦°à¦¾à¦® / Village', m.area || m.village || '-'],
    ['ğŸ“', 'à¦®à§‹à¦¬à¦¾à¦‡à¦² / Mobile', m.phone || '-'],
    ['ğŸ’¼', 'à¦ªà§‡à¦¶à¦¾ / Job', m.job || '-'],
    ['ğŸ“', 'à¦¶à¦¿à¦•à§à¦·à¦¾ / Education', m.education || '-'],
    ['â­', 'à¦ªà¦¦à¦¬à¦¿ / Position', m.position || 'à¦¸à¦¦à¦¸à§à¦¯'],
  ];

  rows.forEach(([ico, label, val], i) => {
    const ry = 92 + i * 58;
    c.fillStyle = i % 2 === 0 ? 'rgba(27,107,27,0.04)' : 'transparent';
    c.fillRect(210, ry - 14, W - 218, 44);
    c.font = '11px Arial';
    c.fillStyle = '#888';
    c.textAlign = 'left';
    c.fillText(`${ico}  ${label}`, rx, ry + 2);
    c.font = 'bold 14px "Hind Siliguri"';
    c.fillStyle = '#1a1200';
    c.fillText(val, rx + 8, ry + 20);
  });

  // Footer strip
  const footGrd = c.createLinearGradient(200, H - 38, W, H - 38);
  footGrd.addColorStop(0, '#1b6b1b');
  footGrd.addColorStop(1, '#0d2e0d');
  c.fillStyle = footGrd;
  c.fillRect(200, H - 38, W - 200, 38);
  c.fillStyle = 'rgba(255,215,0,0.8)';
  c.font = '10px "Hind Siliguri"';
  c.textAlign = 'center';
  c.textBaseline = 'middle';
  c.fillText('à¦¸à§‡à¦¬à¦¾à¦¯à¦¼ à¦¨à¦¿à¦¬à§‡à¦¦à¦¿à¦¤ Â· 01817-984524 Â· issaidur999@gmail.com', (200 + W) / 2, H - 19);

  // Developer watermark
  c.save();
  c.globalAlpha = 0.25;
  c.fillStyle = '#8b6914';
  c.font = 'bold 12px Arial';
  c.textAlign = 'right';
  c.textBaseline = 'bottom';
  c.fillText('Developed by Saidur', W - 12, H - 42);
  c.restore();
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   DRAW VOLUNTEER CERTIFICATE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function drawVolunteer(m, photo) {
  const canvas = document.getElementById('volunteerCanvas');
  const c = canvas.getContext('2d');
  const W = 1122, H = 794;
  c.clearRect(0, 0, W, H);

  // Background â€” warm white with subtle green tint
  c.fillStyle = '#f8fff8';
  c.fillRect(0, 0, W, H);

  // Background decorative arcs
  c.save();
  c.globalAlpha = 0.04;
  c.strokeStyle = '#2e8b2e';
  c.lineWidth = 60;
  c.beginPath();
  c.arc(-100, -100, 500, 0, Math.PI / 2);
  c.stroke();
  c.beginPath();
  c.arc(W + 100, H + 100, 500, Math.PI, Math.PI + Math.PI / 2);
  c.stroke();
  c.restore();

  // Border
  const grd = c.createLinearGradient(0, 0, W, H);
  grd.addColorStop(0, '#1b6b1b');
  grd.addColorStop(0.5, '#2e8b2e');
  grd.addColorStop(1, '#1b6b1b');

  c.strokeStyle = grd;
  c.lineWidth = 16;
  c.strokeRect(8, 8, W - 16, H - 16);

  const goldGrd = c.createLinearGradient(0, 0, W, 0);
  goldGrd.addColorStop(0, '#b8860b');
  goldGrd.addColorStop(0.5, '#ffd700');
  goldGrd.addColorStop(1, '#b8860b');
  c.strokeStyle = goldGrd;
  c.lineWidth = 3;
  c.strokeRect(24, 24, W - 48, H - 48);

  // Top header bg
  const topGrd = c.createLinearGradient(0, 30, 0, 160);
  topGrd.addColorStop(0, 'rgba(27,107,27,0.12)');
  topGrd.addColorStop(1, 'rgba(27,107,27,0)');
  c.fillStyle = topGrd;
  c.fillRect(30, 30, W - 60, 130);

  // Org name
  c.fillStyle = '#1b6b1b';
  c.font = 'bold 30px "Hind Siliguri"';
  c.textAlign = 'center';
  c.textBaseline = 'alphabetic';
  c.fillText('à¦¸à¦®à¦¾à¦œ à¦•à¦²à§à¦¯à¦¾à¦£ à¦¯à§à¦¬ à¦¸à¦‚à¦—à¦ à¦¨', W / 2, 82);
  c.fillStyle = '#8b6914';
  c.font = 'italic 14px Georgia';
  c.fillText('Somaj Kalyan Jubo Sangathan Â· Ramkrisnopur, Doulatpur, Kushtia Â· Est. 2025', W / 2, 104);

  // Divider
  c.strokeStyle = goldGrd;
  c.lineWidth = 1.5;
  c.beginPath();
  c.moveTo(80, 122);
  c.lineTo(W - 80, 122);
  c.stroke();

  // Title
  c.fillStyle = '#0d6b0d';
  c.font = 'bold 40px "Cinzel", "Playfair Display", serif';
  c.fillText('VOLUNTEER CERTIFICATE', W / 2, 182);
  c.fillStyle = '#8b6914';
  c.font = 'bold 22px "Hind Siliguri"';
  c.fillText('à¦¸à§à¦¬à§‡à¦šà§à¦›à¦¾à¦¸à§‡à¦¬à§€ à¦¸à¦¾à¦°à§à¦Ÿà¦¿à¦«à¦¿à¦•à§‡à¦Ÿ', W / 2, 214);

  // Volunteer icon / badge
  c.fillStyle = 'rgba(27,107,27,0.08)';
  c.beginPath();
  c.arc(W / 2, 162, 72, 0, Math.PI * 2);
  c.fill();
  c.strokeStyle = goldGrd;
  c.lineWidth = 2;
  c.beginPath();
  c.arc(W / 2, 162, 72, 0, Math.PI * 2);
  c.stroke();
  c.font = '64px serif';
  c.fillStyle = '#1b6b1b';
  c.textBaseline = 'middle';
  c.fillText('ğŸ™‹', W / 2, 162);
  c.textBaseline = 'alphabetic';

  // Body text
  const lx = 80;
  c.textAlign = 'left';
  c.fillStyle = '#444';
  c.font = '16px "Hind Siliguri"';
  c.fillText('à¦¸à¦¶à§à¦°à¦¦à§à¦§à§‡ à¦ªà§à¦°à¦®à¦¾à¦£ à¦•à¦°à¦¾ à¦¹à¦šà§à¦›à§‡ à¦¯à§‡,  /  This is to certify with honor that,', lx, 298);

  // Name
  c.fillStyle = '#1b6b1b';
  c.font = 'bold 38px "Hind Siliguri"';
  c.fillText(m.name || '-', lx, 356);
  const nw = c.measureText(m.name || '-').width;
  c.strokeStyle = goldGrd;
  c.lineWidth = 2;
  c.beginPath();
  c.moveTo(lx, 363);
  c.lineTo(lx + nw, 363);
  c.stroke();

  c.fillStyle = '#333';
  c.font = '15px "Hind Siliguri"';
  c.fillText(`à¦ªà§‡à¦¶à¦¾: ${m.job || 'â€”'}  Â·  à¦¶à¦¿à¦•à§à¦·à¦¾: ${m.education || 'â€”'}`, lx, 394);
  c.fillText(`à¦—à§à¦°à¦¾à¦®: ${m.area || m.village || 'â€”'}  Â·  à¦®à§‹à¦¬à¦¾à¦‡à¦²: ${m.phone || 'â€”'}`, lx, 416);

  const vtxt = `à¦¸à¦®à¦¾à¦œ à¦•à¦²à§à¦¯à¦¾à¦£ à¦¯à§à¦¬ à¦¸à¦‚à¦—à¦ à¦¨à§‡à¦° à¦à¦•à¦œà¦¨ à¦¨à¦¿à¦·à§à¦ à¦¾à¦¬à¦¾à¦¨ à¦¸à§à¦¬à§‡à¦šà§à¦›à¦¾à¦¸à§‡à¦¬à§€ à¦¹à¦¿à¦¸à§‡à¦¬à§‡ à¦¸à¦‚à¦—à¦ à¦¨à§‡à¦° à¦¬à¦¿à¦­à¦¿à¦¨à§à¦¨ à¦¸à¦®à¦¾à¦œà¦¸à§‡à¦¬à¦¾à¦®à§‚à¦²à¦• à¦•à¦¾à¦°à§à¦¯à¦•à§à¦°à¦® à¦¯à§‡à¦®à¦¨ à¦¬à§ƒà¦•à§à¦·à¦°à§‹à¦ªà¦£, à¦¶à¦¿à¦•à§à¦·à¦¾ à¦¸à¦¹à¦¾à¦¯à¦¼à¦¤à¦¾, à¦°à¦•à§à¦¤à¦¦à¦¾à¦¨, à¦¤à§à¦°à¦¾à¦£ à¦¬à¦¿à¦¤à¦°à¦£ à¦‡à¦¤à§à¦¯à¦¾à¦¦à¦¿à¦¤à§‡ à¦¸à¦•à§à¦°à¦¿à¦¯à¦¼à¦­à¦¾à¦¬à§‡ à¦…à¦¬à¦¦à¦¾à¦¨ à¦°à§‡à¦–à§‡à¦›à§‡à¦¨à¥¤`;
  c.fillStyle = '#333';
  c.font = '14px "Hind Siliguri"';
  wrapText(c, vtxt, lx, 434, 680, 22);

  const etxt = `has served as a dedicated volunteer of Somaj Kalyan Jubo Sangathan, actively contributing to tree plantation, education support, blood donation, relief distribution and other social welfare activities.`;
  c.fillStyle = '#666';
  c.font = 'italic 13px Georgia';
  wrapText(c, etxt, lx, 500, 680, 20);

  // Date & ID
  c.fillStyle = '#1b6b1b';
  c.font = 'bold 13px "Hind Siliguri"';
  c.fillText(`à¦¸à¦¦à¦¸à§à¦¯ ID: ${m.memberId || 'â€”'}`, lx, 580);
  c.fillStyle = '#555';
  c.font = '13px "Hind Siliguri"';
  c.fillText(`à¦¤à¦¾à¦°à¦¿à¦–: ${today()}  /  Date: ${todayEn()}`, lx, 600);

  // Photo (right)
  const pX = W - 148, pY = 420, pR = 78;
  c.save();
  c.beginPath();
  c.arc(pX, pY, pR, 0, Math.PI * 2);
  c.clip();
  if (photo) { c.drawImage(photo, pX - pR, pY - pR, pR * 2, pR * 2); }
  else {
    c.fillStyle = '#e8f5e8';
    c.fillRect(pX - pR, pY - pR, pR * 2, pR * 2);
    c.fillStyle = '#1b6b1b';
    c.font = 'bold 58px Arial';
    c.textAlign = 'center';
    c.textBaseline = 'middle';
    c.fillText(ini(m.name), pX, pY + 3);
  }
  c.restore();
  c.strokeStyle = goldGrd;
  c.lineWidth = 4;
  c.beginPath();
  c.arc(pX, pY, pR + 2, 0, Math.PI * 2);
  c.stroke();

  // Signatures
  drawSignature(c, 100, 720, 'à¦¸à¦­à¦¾à¦ªà¦¤à¦¿', 'à¦®à§‹à¦ƒ à¦¶à¦¿à¦®à§à¦² à¦¹à§‹à¦¸à§‡à¦¨', goldGrd);
  drawSignature(c, 400, 720, 'à¦¸à¦¾à¦§à¦¾à¦°à¦£ à¦¸à¦®à§à¦ªà¦¾à¦¦à¦•', 'à¦®à§‹à¦ƒ à¦œà¦¾à¦•à¦¿à¦° à¦¹à§‹à¦¸à§‡à¦¨', goldGrd);
  drawSignature(c, 700, 720, 'à¦¸à¦¾à¦§à¦¾à¦°à¦£ à¦¸à¦®à§à¦ªà¦¾à¦¦à¦•', 'à¦®à§‹à¦ƒ à¦¶à§à¦­ à¦†à¦²à§€', goldGrd);

  // Seal
  drawSeal(c, W - 148, 640, 50, goldGrd);

  // Footer
  const fg = c.createLinearGradient(0, H - 44, 0, H);
  fg.addColorStop(0, '#1b6b1b');
  fg.addColorStop(1, '#0d2e0d');
  c.fillStyle = fg;
  c.fillRect(30, H - 44, W - 60, 20);
  c.fillStyle = 'rgba(255,215,0,0.85)';
  c.font = '11px "Hind Siliguri"';
  c.textAlign = 'center';
  c.textBaseline = 'middle';
  c.fillText('à¦¸à§‡à¦¬à¦¾à¦¯à¦¼ à¦¨à¦¿à¦¬à§‡à¦¦à¦¿à¦¤, à¦‰à¦¨à§à¦¨à¦¯à¦¼à¦¨à§‡ à¦ªà§à¦°à¦¤à¦¿à¦¶à§à¦°à§à¦¤à¦¿à¦¬à¦¦à§à¦§  Â·  Dedicated to Service, Committed to Development', W / 2, H - 34);

  // Watermark
  c.save();
  c.globalAlpha = 0.22;
  c.fillStyle = '#8b6914';
  c.font = 'bold 16px Arial';
  c.textAlign = 'right';
  c.textBaseline = 'bottom';
  c.fillText('Developed by Saidur', W - 60, H - 50);
  c.restore();
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   DRAW PARTICIPATION CERTIFICATE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function drawParticipation(m, photo) {
  const canvas = document.getElementById('participationCanvas');
  const c = canvas.getContext('2d');
  const W = 1122, H = 794;
  c.clearRect(0, 0, W, H);

  c.fillStyle = '#fffdf0';
  c.fillRect(0, 0, W, H);

  // Decorative bg
  c.save();
  c.globalAlpha = 0.025;
  for (let i = 0; i < W; i += 60) {
    for (let j = 0; j < H; j += 60) {
      c.fillStyle = '#daa520';
      c.beginPath();
      c.arc(i, j, 12, 0, Math.PI * 2);
      c.fill();
    }
  }
  c.restore();

  const goldGrd = c.createLinearGradient(0, 0, W, 0);
  goldGrd.addColorStop(0, '#b8860b');
  goldGrd.addColorStop(0.5, '#ffd700');
  goldGrd.addColorStop(1, '#b8860b');

  // Triple border
  c.strokeStyle = goldGrd;
  c.lineWidth = 12;
  c.strokeRect(6, 6, W - 12, H - 12);
  c.strokeStyle = '#1b6b1b';
  c.lineWidth = 4;
  c.strokeRect(20, 20, W - 40, H - 40);
  c.strokeStyle = goldGrd;
  c.lineWidth = 1.5;
  c.strokeRect(30, 30, W - 60, H - 60);

  // Header
  c.fillStyle = '#1b6b1b';
  c.font = 'bold 28px "Hind Siliguri"';
  c.textAlign = 'center';
  c.textBaseline = 'alphabetic';
  c.fillText('à¦¸à¦®à¦¾à¦œ à¦•à¦²à§à¦¯à¦¾à¦£ à¦¯à§à¦¬ à¦¸à¦‚à¦—à¦ à¦¨', W / 2, 80);
  c.fillStyle = '#8b6914';
  c.font = 'italic 13px Georgia';
  c.fillText('Somaj Kalyan Jubo Sangathan Â· Ramkrisnopur, Doulatpur, Kushtia', W / 2, 100);

  c.strokeStyle = goldGrd;
  c.lineWidth = 1;
  c.beginPath();
  c.moveTo(80, 116);
  c.lineTo(W - 80, 116);
  c.stroke();

  // Star medal icon
  c.font = '52px serif';
  c.fillStyle = '#daa520';
  c.textBaseline = 'middle';
  c.fillText('ğŸ†', W / 2, 168);
  c.textBaseline = 'alphabetic';

  // Title
  c.fillStyle = '#7a5500';
  c.font = 'bold 38px "Cinzel", serif';
  c.fillText('CERTIFICATE OF PARTICIPATION', W / 2, 224);
  c.fillStyle = '#8b6914';
  c.font = 'bold 20px "Hind Siliguri"';
  c.fillText('à¦…à¦‚à¦¶à¦—à§à¦°à¦¹à¦£ à¦¸à¦¾à¦°à§à¦Ÿà¦¿à¦«à¦¿à¦•à§‡à¦Ÿ', W / 2, 254);

  const tl = c.createLinearGradient(100, 0, W - 100, 0);
  tl.addColorStop(0, 'transparent');
  tl.addColorStop(0.3, '#daa520');
  tl.addColorStop(0.7, '#daa520');
  tl.addColorStop(1, 'transparent');
  c.strokeStyle = tl;
  c.lineWidth = 2;
  c.beginPath();
  c.moveTo(100, 268);
  c.lineTo(W - 100, 268);
  c.stroke();

  // Body
  const lx = 80;
  c.textAlign = 'left';
  c.fillStyle = '#444';
  c.font = '16px "Hind Siliguri"';
  c.fillText('à¦¸à¦—à§Œà¦°à¦¬à§‡ à¦ªà§à¦°à¦®à¦¾à¦£ à¦•à¦°à¦¾ à¦¹à¦šà§à¦›à§‡ à¦¯à§‡,  /  This is to proudly certify that,', lx, 308);

  c.fillStyle = '#1b6b1b';
  c.font = 'bold 36px "Hind Siliguri"';
  c.fillText(m.name || '-', lx, 360);
  const nw = c.measureText(m.name || '-').width;
  c.strokeStyle = goldGrd;
  c.lineWidth = 2;
  c.beginPath();
  c.moveTo(lx, 367);
  c.lineTo(lx + nw, 367);
  c.stroke();

  c.fillStyle = '#444';
  c.font = '15px "Hind Siliguri"';
  c.fillText(`à¦ªà§‡à¦¶à¦¾: ${m.job || 'â€”'}  Â·  à¦¶à¦¿à¦•à§à¦·à¦¾: ${m.education || 'â€”'}`, lx, 398);
  c.fillText(`à¦—à§à¦°à¦¾à¦®: ${m.area || m.village || 'â€”'}  Â·  ID: ${m.memberId || 'â€”'}`, lx, 420);

  const pt = `à¦¸à¦®à¦¾à¦œ à¦•à¦²à§à¦¯à¦¾à¦£ à¦¯à§à¦¬ à¦¸à¦‚à¦—à¦ à¦¨à§‡à¦° à¦¬à¦¿à¦­à¦¿à¦¨à§à¦¨ à¦¸à¦¾à¦®à¦¾à¦œà¦¿à¦• à¦•à¦¾à¦°à§à¦¯à¦•à§à¦°à¦® à¦“ à¦…à¦¨à§à¦·à§à¦ à¦¾à¦¨à§‡ à¦¸à¦•à§à¦°à¦¿à¦¯à¦¼à¦­à¦¾à¦¬à§‡ à¦…à¦‚à¦¶à¦—à§à¦°à¦¹à¦£ à¦•à¦°à§‡à¦›à§‡à¦¨à¥¤ à¦¤à¦¾à¦à¦° à¦à¦‡ à¦…à¦¬à¦¦à¦¾à¦¨ à¦“ à¦‰à¦¦à§à¦¯à§‹à¦— à¦¸à¦‚à¦—à¦ à¦¨à¦•à§‡ à¦à¦—à¦¿à¦¯à¦¼à§‡ à¦¨à¦¿à¦¯à¦¼à§‡ à¦¯à§‡à¦¤à§‡ à¦¸à¦¹à¦¾à¦¯à¦¼à¦¤à¦¾ à¦•à¦°à¦›à§‡à¥¤`;
  c.fillStyle = '#333';
  c.font = '14px "Hind Siliguri"';
  wrapText(c, pt, lx, 450, 680, 22);

  const pe = `has actively participated in various social programs and events of Somaj Kalyan Jubo Sangathan. His/her contribution and enthusiasm is helping the organization move forward.`;
  c.fillStyle = '#666';
  c.font = 'italic 13px Georgia';
  wrapText(c, pe, lx, 506, 680, 20);

  c.fillStyle = '#1b6b1b';
  c.font = 'bold 13px "Hind Siliguri"';
  c.fillText(`à¦¤à¦¾à¦°à¦¿à¦–: ${today()}  /  Date: ${todayEn()}`, lx, 572);

  // Photo
  const pX = W - 148, pY = 420, pR = 76;
  c.save();
  c.beginPath();
  c.arc(pX, pY, pR, 0, Math.PI * 2);
  c.clip();
  if (photo) { c.drawImage(photo, pX - pR, pY - pR, pR * 2, pR * 2); }
  else {
    c.fillStyle = '#fff9e6';
    c.fillRect(pX - pR, pY - pR, pR * 2, pR * 2);
    c.fillStyle = '#8b6914';
    c.font = 'bold 56px Arial';
    c.textAlign = 'center';
    c.textBaseline = 'middle';
    c.fillText(ini(m.name), pX, pY + 3);
  }
  c.restore();
  c.strokeStyle = goldGrd;
  c.lineWidth = 4;
  c.beginPath();
  c.arc(pX, pY, pR + 2, 0, Math.PI * 2);
  c.stroke();

  drawSignature(c, 100, 718, 'à¦¸à¦­à¦¾à¦ªà¦¤à¦¿', 'à¦®à§‹à¦ƒ à¦¶à¦¿à¦®à§à¦² à¦¹à§‹à¦¸à§‡à¦¨', goldGrd);
  drawSignature(c, 400, 718, 'à¦¸à¦¾à¦§à¦¾à¦°à¦£ à¦¸à¦®à§à¦ªà¦¾à¦¦à¦•', 'à¦®à§‹à¦ƒ à¦œà¦¾à¦•à¦¿à¦° à¦¹à§‹à¦¸à§‡à¦¨', goldGrd);
  drawSignature(c, 700, 718, 'à¦¸à¦¾à¦§à¦¾à¦°à¦£ à¦¸à¦®à§à¦ªà¦¾à¦¦à¦•', 'à¦®à§‹à¦ƒ à¦¶à§à¦­ à¦†à¦²à§€', goldGrd);
  drawSeal(c, W - 148, 636, 50, goldGrd);

  // Footer
  const fg = c.createLinearGradient(0, H - 44, 0, H);
  fg.addColorStop(0, '#7a5500');
  fg.addColorStop(1, '#4a3300');
  c.fillStyle = fg;
  c.fillRect(36, H - 44, W - 72, 20);
  c.fillStyle = 'rgba(255,215,0,0.85)';
  c.font = '11px "Hind Siliguri"';
  c.textAlign = 'center';
  c.textBaseline = 'middle';
  c.fillText('à¦¯à§à¦¬à¦¶à¦•à§à¦¤à¦¿à¦‡ à¦ªà¦°à¦¿à¦¬à¦°à§à¦¤à¦¨à§‡à¦° à¦¹à¦¾à¦¤à¦¿à¦¯à¦¼à¦¾à¦°  Â·  Youth is the Instrument of Change', W / 2, H - 34);

  c.save();
  c.globalAlpha = 0.22;
  c.fillStyle = '#8b6914';
  c.font = 'bold 16px Arial';
  c.textAlign = 'right';
  c.textBaseline = 'bottom';
  c.fillText('Developed by Saidur', W - 60, H - 50);
  c.restore();
}

/* â•â• HELPER FUNCTIONS â•â• */
function wrapText(c, text, x, y, maxW, lineH) {
  const words = text.split(' ');
  let line = '';
  for (const word of words) {
    const test = line + word + ' ';
    if (c.measureText(test).width > maxW && line !== '') {
      c.fillText(line.trim(), x, y);
      line = word + ' ';
      y += lineH;
    } else {
      line = test;
    }
  }
  c.fillText(line.trim(), x, y);
}

function drawSignature(c, x, y, role, name, grd) {
  c.strokeStyle = grd;
  c.lineWidth = 1.5;
  c.beginPath();
  c.moveTo(x - 50, y);
  c.lineTo(x + 110, y);
  c.stroke();
  c.fillStyle = '#1b6b1b';
  c.font = 'bold 13px "Hind Siliguri"';
  c.textAlign = 'center';
  c.textBaseline = 'alphabetic';
  c.fillText(role, x + 30, y + 18);
  c.fillStyle = '#555';
  c.font = '12px "Hind Siliguri"';
  c.fillText(name, x + 30, y + 34);
}

function drawSeal(c, cx, cy, r, grd) {
  c.save();
  c.globalAlpha = 0.15;
  c.strokeStyle = grd;
  c.lineWidth = 3;
  c.beginPath();
  c.arc(cx, cy, r, 0, Math.PI * 2);
  c.stroke();
  c.beginPath();
  c.arc(cx, cy, r - 8, 0, Math.PI * 2);
  c.stroke();
  c.fillStyle = '#1b6b1b';
  c.font = `bold ${Math.round(r * 0.28)}px "Hind Siliguri"`;
  c.textAlign = 'center';
  c.textBaseline = 'middle';
  c.fillText('à¦¸à¦‚à¦—à¦ à¦¨', cx, cy - 5);
  c.fillText('à¦¸à§€à¦²', cx, cy + 12);
  c.restore();
}

function drawCornerOrnament(c, x, y, grd, flipX = false, flipY = false) {
  c.save();
  c.translate(x, y);
  if (flipX) c.scale(-1, 1);
  if (flipY) c.scale(1, -1);
  c.strokeStyle = grd;
  c.lineWidth = 2;
  c.beginPath();
  c.moveTo(0, 0); c.lineTo(40, 0); c.moveTo(0, 0); c.lineTo(0, 40);
  c.stroke();
  c.fillStyle = '#b8860b';
  c.font = '16px serif';
  c.textAlign = 'left';
  c.textBaseline = 'top';
  c.fillText('âœ¦', 3, 3);
  c.restore();
}

/* â•â• DOWNLOAD â•â• */
function downloadCert(type, format) {
  const canvasMap = {
    membership: 'membershipCanvas',
    idcard: 'idCanvas',
    volunteer: 'volunteerCanvas',
    participation: 'participationCanvas'
  };
  const nameMap = {
    membership: 'à¦¸à¦¦à¦¸à§à¦¯à¦ªà¦¦_à¦¸à¦¾à¦°à§à¦Ÿà¦¿à¦«à¦¿à¦•à§‡à¦Ÿ',
    idcard: 'ID_à¦•à¦¾à¦°à§à¦¡',
    volunteer: 'à¦¸à§à¦¬à§‡à¦šà§à¦›à¦¾à¦¸à§‡à¦¬à§€_à¦¸à¦¾à¦°à§à¦Ÿà¦¿à¦«à¦¿à¦•à§‡à¦Ÿ',
    participation: 'à¦…à¦‚à¦¶à¦—à§à¦°à¦¹à¦£_à¦¸à¦¾à¦°à§à¦Ÿà¦¿à¦«à¦¿à¦•à§‡à¦Ÿ'
  };
  const canvas = document.getElementById(canvasMap[type]);
  const mn = (_member?.name || 'member').replace(/\s+/g, '_');
  const fname = `${nameMap[type]}_${mn}`;

  if (format === 'jpg') {
    const a = document.createElement('a');
    a.download = fname + '.jpg';
    a.href = canvas.toDataURL('image/jpeg', 0.96);
    a.click();
  } else {
    try {
      const { jsPDF } = window.jspdf;
      const isLandscape = type !== 'idcard';
      const isA4 = type !== 'idcard';
      let pdf;
      if (type === 'idcard') {
        pdf = new jsPDF({ orientation: 'landscape', unit: 'mm', format: [85.6, 53.98] });
        pdf.addImage(canvas.toDataURL('image/jpeg', 0.96), 'JPEG', 0, 0, 85.6, 53.98);
      } else {
        pdf = new jsPDF({ orientation: 'landscape', unit: 'mm', format: 'a4' });
        pdf.addImage(canvas.toDataURL('image/jpeg', 0.96), 'JPEG', 0, 0, 297, 210);
      }
      pdf.save(fname + '.pdf');
    } catch (e) {
      // fallback to jpg
      const a = document.createElement('a');
      a.download = fname + '.jpg';
      a.href = canvas.toDataURL('image/jpeg', 0.96);
      a.click();
    }
  }
}

/* â•â• RENDER INFO GRID â•â• */
function renderInfoGrid(m) {
  const mInfo = document.getElementById('membershipInfo');
  const idInfo = document.getElementById('idInfo');
  const rows = [
    ['ğŸªª', 'à¦¸à¦¦à¦¸à§à¦¯ ID', m.memberId || 'â€”'],
    ['ğŸ‘¤', 'à¦¨à¦¾à¦®', m.name || 'â€”'],
    ['ğŸ“', 'à¦à¦²à¦¾à¦•à¦¾', m.area || m.village || 'â€”'],
    ['ğŸ“', 'à¦®à§‹à¦¬à¦¾à¦‡à¦²', m.phone || 'â€”'],
    ['ğŸ©¸', 'à¦°à¦•à§à¦¤à§‡à¦° à¦—à§à¦°à§à¦ª', m.bloodGroup || 'â€”'],
    ['ğŸ’¼', 'à¦ªà§‡à¦¶à¦¾', m.job || 'â€”'],
    ['ğŸ“', 'à¦¶à¦¿à¦•à§à¦·à¦¾', m.education || 'â€”'],
    ['â­', 'à¦ªà¦¦à¦¬à¦¿', m.position || 'à¦¸à¦¦à¦¸à§à¦¯'],
  ];
  const html = rows.map(([i, k, v]) =>
    `<div class="cert-info-item"><span class="cert-info-ico">${i}</span><div class="cert-info-txt"><strong>${k}</strong><span>${v}</span></div></div>`
  ).join('');
  if (mInfo) mInfo.innerHTML = html;
  if (idInfo) idInfo.innerHTML = html;
}
</script>

<!-- Firebase Module -->
<script type="module">
import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js';
import { getAuth, onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js';
import { getFirestore, doc, getDoc } from 'https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js';

const firebaseConfig = {
  apiKey: "AIzaSyDwzJgWcc4XPt4czcXpVFkHTniJFISpO7I",
  authDomain: "somaj-kallyan.firebaseapp.com",
  projectId: "somaj-kallyan",
  appId: "1:392871962816:web:0f7ebbc36a3d8c784da525"
};
const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

function hideLoader() {
  const l = document.getElementById('loader');
  if (l) { l.style.opacity = '0'; setTimeout(() => l.style.display = 'none', 500); }
}

function loadPhoto(url) {
  return new Promise(resolve => {
    if (!url) return resolve(null);
    const img = new Image();
    img.crossOrigin = 'anonymous';
    img.onload = () => resolve(img);
    img.onerror = () => resolve(null);
    img.src = url;
  });
}

onAuthStateChanged(auth, async (user) => {
  hideLoader();
  if (!user) {
    document.getElementById('notLoggedIn').style.display = 'block';
    return;
  }
  try {
    const snap = await getDoc(doc(db, 'users', user.uid));
    if (!snap.exists()) { document.getElementById('notLoggedIn').style.display = 'block'; return; }
    const m = { ...snap.data(), uid: user.uid };

    if (m.status !== 'approved') {
      // Show pending message
      document.getElementById('mainContent').style.display = 'block';
      document.getElementById('mainContent').innerHTML = `
        <div class="pending-cert">
          <div class="ico">â³</div>
          <h4>à¦…à¦¨à§à¦®à§‹à¦¦à¦¨à§‡à¦° à¦…à¦ªà§‡à¦•à§à¦·à¦¾à¦¯à¦¼</h4>
          <p>à¦†à¦ªà¦¨à¦¾à¦° à¦¸à¦¦à¦¸à§à¦¯à¦ªà¦¦ à¦à¦–à¦¨à§‹ à¦…à¦¨à§à¦®à§‹à¦¦à¦¨ à¦¹à¦¯à¦¼à¦¨à¦¿à¥¤<br>Admin à¦…à¦¨à§à¦®à§‹à¦¦à¦¨ à¦•à¦°à¦²à§‡ à¦¸à¦¾à¦°à§à¦Ÿà¦¿à¦«à¦¿à¦•à§‡à¦Ÿ à¦ªà¦¾à¦¬à§‡à¦¨à¥¤<br><br>
          à¦¯à§‹à¦—à¦¾à¦¯à§‹à¦—: <strong style="color:var(--sgold)">01817-984524</strong></p>
        </div>`;
      return;
    }

    // Set global member
    window._member = m;

    // Update nav
    document.getElementById('navUser').style.display = 'flex';
    const navAv = document.getElementById('navAv');
    if (m.photoUrl) navAv.innerHTML = `<img src="${m.photoUrl}" style="width:100%;height:100%;object-fit:cover;">`;
    else navAv.textContent = (m.name || '?').charAt(0);
    document.getElementById('navName').textContent = m.name?.split(' ')[0] || 'à¦¸à¦¦à¦¸à§à¦¯';

    // Update user card
    document.getElementById('mainContent').style.display = 'block';
    const bigAv = document.getElementById('bigAv');
    if (m.photoUrl) bigAv.innerHTML = `<img src="${m.photoUrl}" style="width:100%;height:100%;object-fit:cover;border-radius:50%">`;
    else bigAv.textContent = (m.name || '?').charAt(0);
    document.getElementById('uName').textContent = m.name || '-';
    document.getElementById('uInfo').textContent = `ğŸ“ ${m.area || m.village || 'â€”'}  Â·  ğŸ“ ${m.phone || 'â€”'}  Â·  ğŸ’¼ ${m.job || 'â€”'}  Â·  ğŸ“ ${m.education || 'â€”'}`;
    document.getElementById('uBadge').textContent = m.position || 'à¦¸à¦¦à¦¸à§à¦¯';
    document.getElementById('uId').textContent = m.memberId ? 'ğŸªª ' + m.memberId : '';

    // Load photo for canvas
    const photoImg = await loadPhoto(m.photoUrl);
    window._photoImg = photoImg;

    // Render info grids
    renderInfoGrid(m);

    // Draw initial certificate (membership tab is default)
    drawMembership(m, photoImg);

  } catch (e) {
    console.error('Error:', e.message);
    document.getElementById('notLoggedIn').style.display = 'block';
  }
});
</script>

</body>
</html>