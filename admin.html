<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin Panel ‚Äî ‡¶∏‡¶Æ‡¶æ‡¶ú ‡¶ï‡¶≤‡ßç‡¶Ø‡¶æ‡¶£ ‡¶Ø‡ßÅ‡¶¨ ‡¶∏‡¶Ç‡¶ó‡¶†‡¶®</title>
<link href="https://fonts.googleapis.com/css2?family=Hind+Siliguri:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<style>
:root{
  --g1:#061a06;--g2:#0d2e0d;--g3:#1b6b1b;--g4:#2e8b2e;--g5:#43a843;
  --gold:#f0b429;--sgold:#ffd966;--dgold:#c8940a;
  --glass:rgba(255,255,255,0.07);--glass2:rgba(255,255,255,0.12);
  --b1:rgba(255,255,255,0.15);--b2:rgba(240,180,41,0.35);
  --blur:blur(18px);--text:#e8f5e8;--text2:#a5d6a7;
  --sidebar:260px;
}
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:'Hind Siliguri',sans-serif;background:var(--g1);color:var(--text);min-height:100vh;display:flex;}
body::before{content:'';position:fixed;inset:0;z-index:0;pointer-events:none;
  background:radial-gradient(ellipse 60% 50% at 20% 30%,rgba(46,139,46,.18),transparent 65%);}

/* ‚ïê‚ïê‚ïê SIDEBAR ‚ïê‚ïê‚ïê */
.sidebar{width:var(--sidebar);background:rgba(6,26,6,.92);backdrop-filter:var(--blur);border-right:1px solid var(--b2);position:fixed;top:0;left:0;bottom:0;z-index:100;display:flex;flex-direction:column;transition:transform .3s;}
.sidebar-logo{padding:22px 20px 16px;border-bottom:1px solid rgba(240,180,41,.15);display:flex;align-items:center;gap:12px;}
.sidebar-logo img{width:44px;height:44px;border-radius:50%;border:2px solid var(--gold);}
.sidebar-logo-txt .title{color:var(--sgold);font-size:11px;font-weight:700;line-height:1.3;}
.sidebar-logo-txt .sub{color:var(--text2);font-size:10px;}
.sidebar-badge{display:inline-block;margin-top:4px;padding:2px 8px;border-radius:8px;font-size:10px;font-weight:700;background:linear-gradient(135deg,var(--gold),var(--sgold));color:var(--g1);}

.sidebar-nav{flex:1;overflow-y:auto;padding:14px 10px;}
.nav-section{color:rgba(255,255,255,.25);font-size:10px;font-weight:700;text-transform:uppercase;letter-spacing:1.2px;padding:14px 10px 6px;}
.nav-item{display:flex;align-items:center;gap:10px;padding:10px 12px;border-radius:10px;cursor:pointer;color:rgba(255,255,255,.65);font-size:13px;font-weight:500;transition:all .22s;border:1px solid transparent;margin-bottom:2px;}
.nav-item:hover{background:var(--glass2);color:#fff;}
.nav-item.active{background:rgba(240,180,41,.15);color:var(--sgold);border-color:var(--b2);}
.nav-item .ico{font-size:1rem;width:20px;text-align:center;}
.nav-item .badge{margin-left:auto;background:rgba(244,67,54,.8);color:#fff;border-radius:10px;padding:1px 7px;font-size:11px;font-weight:700;}

.sidebar-footer{padding:16px;border-top:1px solid rgba(255,255,255,.06);}
.user-info{display:flex;align-items:center;gap:10px;margin-bottom:10px;}
.user-av{width:36px;height:36px;border-radius:50%;background:var(--g3);border:1.5px solid var(--gold);object-fit:cover;overflow:hidden;display:flex;align-items:center;justify-content:center;font-size:14px;font-weight:700;}
.user-name{color:var(--sgold);font-size:13px;font-weight:600;}
.user-role{color:rgba(255,255,255,.4);font-size:11px;}
.logout-btn{width:100%;padding:8px;border:1px solid rgba(244,67,54,.3);background:rgba(244,67,54,.08);color:#ff6b6b;border-radius:8px;cursor:pointer;font-size:13px;font-family:inherit;transition:all .2s;}
.logout-btn:hover{background:rgba(244,67,54,.18);}

/* ‚ïê‚ïê‚ïê MAIN ‚ïê‚ïê‚ïê */
.main{margin-left:var(--sidebar);flex:1;display:flex;flex-direction:column;min-height:100vh;position:relative;z-index:1;}
.topbar{padding:16px 28px;background:rgba(6,26,6,.7);backdrop-filter:var(--blur);border-bottom:1px solid rgba(255,255,255,.06);display:flex;align-items:center;justify-content:space-between;position:sticky;top:0;z-index:50;}
.topbar h2{color:var(--sgold);font-size:1.1rem;font-weight:700;}
.topbar-right{display:flex;gap:10px;align-items:center;}
.ham-btn{display:none;background:none;border:none;color:var(--sgold);font-size:1.4rem;cursor:pointer;}

.content{padding:24px 28px;flex:1;}

/* ‚ïê‚ïê‚ïê CARDS ‚ïê‚ïê‚ïê */
.stat-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(200px,1fr));gap:16px;margin-bottom:28px;}
.stat-card{padding:22px 20px;border-radius:16px;background:var(--glass);backdrop-filter:var(--blur);border:1px solid var(--b1);position:relative;overflow:hidden;}
.stat-card::before{content:'';position:absolute;top:-20px;right:-20px;width:80px;height:80px;border-radius:50%;opacity:.12;}
.stat-card.gold::before{background:var(--gold);}
.stat-card.green::before{background:var(--g4);}
.stat-card.red::before{background:#f44336;}
.stat-card.blue::before{background:#2196f3;}
.stat-num{font-size:2.2rem;font-weight:700;color:var(--sgold);}
.stat-label{color:var(--text2);font-size:13px;margin-top:4px;}
.stat-ico{position:absolute;top:18px;right:18px;font-size:1.8rem;opacity:.6;}

/* ‚ïê‚ïê‚ïê TABLE ‚ïê‚ïê‚ïê */
.table-wrap{background:var(--glass);backdrop-filter:var(--blur);border:1px solid var(--b1);border-radius:16px;overflow:hidden;}
.table-head{padding:18px 22px;border-bottom:1px solid rgba(255,255,255,.06);display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:12px;}
.table-head h3{color:var(--sgold);font-size:1rem;font-weight:700;}
.search-inp{padding:9px 16px;background:var(--glass2);border:1px solid var(--b1);border-radius:8px;color:#fff;font-size:13px;font-family:inherit;outline:none;width:220px;}
.search-inp:focus{border-color:var(--b2);}
.search-inp::placeholder{color:rgba(255,255,255,.3);}

table{width:100%;border-collapse:collapse;}
th{padding:13px 16px;text-align:left;color:rgba(255,255,255,.4);font-size:12px;font-weight:600;text-transform:uppercase;letter-spacing:.5px;border-bottom:1px solid rgba(255,255,255,.06);}
td{padding:12px 16px;border-bottom:1px solid rgba(255,255,255,.04);font-size:13px;color:rgba(255,255,255,.8);}
tr:last-child td{border-bottom:none;}
tr:hover td{background:rgba(255,255,255,.03);}

.mem-av{width:38px;height:38px;border-radius:50%;border:1.5px solid var(--gold);object-fit:cover;background:var(--g3);display:flex;align-items:center;justify-content:center;font-size:14px;font-weight:700;overflow:hidden;flex-shrink:0;}
.mem-info{display:flex;align-items:center;gap:10px;}
.mem-name{color:var(--sgold);font-weight:600;}
.mem-sub{color:rgba(255,255,255,.4);font-size:11px;}

/* BADGES */
.badge{display:inline-block;padding:3px 10px;border-radius:8px;font-size:11px;font-weight:600;}
.b-pending{background:rgba(255,193,7,.15);border:1px solid rgba(255,193,7,.3);color:#ffd54f;}
.b-approved{background:rgba(76,175,80,.15);border:1px solid rgba(76,175,80,.3);color:#81c784;}
.b-rejected{background:rgba(244,67,54,.15);border:1px solid rgba(244,67,54,.3);color:#ef9a9a;}
.b-admin{background:rgba(240,180,41,.15);border:1px solid rgba(240,180,41,.3);color:var(--sgold);}
.b-superadmin{background:linear-gradient(135deg,rgba(255,215,0,.2),rgba(255,215,0,.08));border:1px solid rgba(255,215,0,.4);color:#ffd700;}

/* BUTTONS */
.btn{padding:7px 14px;border-radius:8px;font-size:12px;font-weight:600;cursor:pointer;border:none;font-family:inherit;transition:all .2s;}
.btn-g{background:linear-gradient(135deg,var(--gold),var(--sgold));color:var(--g1);}
.btn-g:hover{transform:translateY(-1px);}
.btn-r{background:rgba(244,67,54,.15);border:1px solid rgba(244,67,54,.3);color:#ff6b6b;}
.btn-r:hover{background:rgba(244,67,54,.25);}
.btn-b{background:rgba(33,150,243,.15);border:1px solid rgba(33,150,243,.3);color:#64b5f6;}
.btn-b:hover{background:rgba(33,150,243,.25);}
.btn-lg{padding:10px 20px;font-size:13px;}

/* TABS */
.page-tabs{display:flex;gap:6px;margin-bottom:20px;flex-wrap:wrap;}
.ptab{padding:8px 18px;border-radius:10px;cursor:pointer;font-size:13px;font-weight:600;border:1px solid var(--b1);background:var(--glass);color:var(--text2);font-family:inherit;transition:all .2s;}
.ptab.active,.ptab:hover{background:rgba(240,180,41,.15);border-color:var(--b2);color:var(--sgold);}

/* FORM IN PANEL */
.form-panel{background:var(--glass);border:1px solid var(--b1);border-radius:16px;padding:24px;margin-bottom:20px;}
.form-panel h4{color:var(--sgold);font-size:1rem;font-weight:700;margin-bottom:16px;padding-bottom:10px;border-bottom:1px solid rgba(255,255,255,.06);}
.fg{margin-bottom:14px;}
.fg label{display:block;margin-bottom:5px;color:rgba(255,255,255,.7);font-size:13px;font-weight:500;}
.fg input,.fg select,.fg textarea{width:100%;padding:10px 14px;background:var(--glass2);border:1px solid var(--b1);border-radius:8px;color:#fff;font-size:13px;font-family:inherit;outline:none;transition:border .2s;}
.fg input:focus,.fg select:focus,.fg textarea:focus{border-color:var(--b2);}
.fg select option{background:#0d2e0d;}
.fg textarea{height:90px;resize:vertical;}
.grid2{display:grid;grid-template-columns:1fr 1fr;gap:14px;}
.grid3{display:grid;grid-template-columns:1fr 1fr 1fr;gap:12px;}

/* ALERT */
.flash{padding:10px 14px;border-radius:8px;font-size:13px;margin-bottom:14px;display:none;}
.flash.show{display:block;}
.flash-ok{background:rgba(76,175,80,.15);border:1px solid rgba(76,175,80,.3);color:#81c784;}
.flash-err{background:rgba(244,67,54,.15);border:1px solid rgba(244,67,54,.3);color:#ff6b6b;}

/* NOTICE CARD */
.notice-row{display:flex;gap:14px;align-items:flex-start;padding:16px;border-bottom:1px solid rgba(255,255,255,.04);}
.notice-row:last-child{border-bottom:none;}
.notice-type-dot{width:10px;height:10px;border-radius:50%;flex-shrink:0;margin-top:5px;}
.notice-content{flex:1;}
.notice-title{color:var(--sgold);font-weight:600;font-size:.9rem;margin-bottom:4px;}
.notice-body{color:rgba(255,255,255,.6);font-size:12px;line-height:1.7;}
.notice-meta{color:rgba(255,255,255,.3);font-size:11px;margin-top:6px;}

/* IMG PREVIEW */
.img-preview-wrap{margin-top:8px;}
.img-preview{width:80px;height:80px;object-fit:cover;border-radius:8px;border:1px solid var(--b1);}

/* EMPTY STATE */
.empty{text-align:center;padding:40px;color:rgba(255,255,255,.3);}
.empty-ico{font-size:3rem;margin-bottom:10px;}

/* MOBILE */
@media(max-width:768px){
  .sidebar{transform:translateX(-100%);}
  .sidebar.open{transform:translateX(0);}
  .main{margin-left:0;}
  .ham-btn{display:block;}
  .content{padding:16px;}
  .grid2,.grid3{grid-template-columns:1fr;}
  .stat-grid{grid-template-columns:1fr 1fr;}
  table{font-size:12px;}
  th,td{padding:10px 10px;}
}

/* OVERLAY for mobile sidebar */
.sidebar-overlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,.6);z-index:99;}
.sidebar-overlay.open{display:block;}

/* SCROLL */
.sidebar-nav::-webkit-scrollbar,.content::-webkit-scrollbar{width:4px;}
.sidebar-nav::-webkit-scrollbar-thumb,.content::-webkit-scrollbar-thumb{background:rgba(240,180,41,.2);border-radius:2px;}
</style>
</head>
<body>

<!-- Mobile sidebar overlay -->
<div class="sidebar-overlay" id="sidebarOverlay" onclick="closeSidebar()"></div>

<!-- ‚ïê‚ïê‚ïê SIDEBAR ‚ïê‚ïê‚ïê -->
<div class="sidebar" id="sidebar">
  <div class="sidebar-logo">
    <img src="https://i.ibb.co.com/XZF23TDY/received-895949380028820.jpg" alt="Logo">
    <div class="sidebar-logo-txt">
      <div class="title">‡¶∏‡¶Æ‡¶æ‡¶ú ‡¶ï‡¶≤‡ßç‡¶Ø‡¶æ‡¶£ ‡¶Ø‡ßÅ‡¶¨ ‡¶∏‡¶Ç‡¶ó‡¶†‡¶®</div>
      <div class="sub">Admin Panel</div>
      <div class="sidebar-badge" id="adminBadge">‚≠ê Super Admin</div>
    </div>
  </div>

  <nav class="sidebar-nav">
    <div class="nav-section">‡¶™‡ßç‡¶∞‡¶ß‡¶æ‡¶®</div>
    <div class="nav-item active" onclick="goSection('dashboard')"><span class="ico">üìä</span> ‡¶°‡ßç‡¶Ø‡¶æ‡¶∂‡¶¨‡ßã‡¶∞‡ßç‡¶°</div>

    <div class="nav-section">‡¶∏‡¶¶‡¶∏‡ßç‡¶Ø ‡¶¨‡ßç‡¶Ø‡¶¨‡¶∏‡ßç‡¶•‡¶æ‡¶™‡¶®‡¶æ</div>
    <div class="nav-item" onclick="goSection('pending')"><span class="ico">‚è≥</span> ‡¶™‡ßá‡¶®‡ßç‡¶°‡¶ø‡¶Ç ‡¶Ü‡¶¨‡ßá‡¶¶‡¶® <span class="badge" id="pendingBadge">0</span></div>
    <div class="nav-item" onclick="goSection('members')"><span class="ico">üë•</span> ‡¶∏‡¶ï‡¶≤ ‡¶∏‡¶¶‡¶∏‡ßç‡¶Ø</div>
    <div class="nav-item" onclick="goSection('admins')" id="nav-admins"><span class="ico">üîë</span> Admin ‡¶¨‡ßç‡¶Ø‡¶¨‡¶∏‡ßç‡¶•‡¶æ‡¶™‡¶®‡¶æ</div>

    <div class="nav-section">‡¶ï‡¶®‡ßç‡¶ü‡ßá‡¶®‡ßç‡¶ü</div>
    <div class="nav-item" onclick="goSection('notices')"><span class="ico">üì¢</span> ‡¶®‡ßã‡¶ü‡¶ø‡¶∂</div>
    <div class="nav-item" onclick="goSection('gallery')"><span class="ico">üì∑</span> ‡¶ó‡ßç‡¶Ø‡¶æ‡¶≤‡¶æ‡¶∞‡¶ø</div>
    <div class="nav-item" onclick="goSection('stats')"><span class="ico">üìà</span> ‡¶™‡¶∞‡¶ø‡¶∏‡¶Ç‡¶ñ‡ßç‡¶Ø‡¶æ‡¶®</div>

    <div class="nav-section">‡¶Ö‡¶®‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶Ø</div>
    <div class="nav-item" onclick="window.open('index.html','_blank')"><span class="ico">üåê</span> ‡¶Æ‡ßÇ‡¶≤ ‡¶∏‡¶æ‡¶á‡¶ü ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®</div>
  </nav>

  <div class="sidebar-footer">
    <div class="user-info">
      <div class="user-av" id="sidebarAv">S</div>
      <div>
        <div class="user-name" id="sidebarName">‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</div>
        <div class="user-role" id="sidebarRole">Admin</div>
      </div>
    </div>
    <button class="logout-btn" onclick="doLogout()">üö™ ‡¶≤‡¶ó‡¶Ü‡¶â‡¶ü</button>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê MAIN ‚ïê‚ïê‚ïê -->
<div class="main">
  <div class="topbar">
    <div style="display:flex;align-items:center;gap:14px;">
      <button class="ham-btn" onclick="openSidebar()">‚ò∞</button>
      <h2 id="sectionTitle">üìä ‡¶°‡ßç‡¶Ø‡¶æ‡¶∂‡¶¨‡ßã‡¶∞‡ßç‡¶°</h2>
    </div>
    <div class="topbar-right">
      <span style="color:rgba(255,255,255,.4);font-size:12px;" id="currentTime"></span>
    </div>
  </div>

  <div class="content">

    <!-- ‚ïê‚ïê DASHBOARD ‚ïê‚ïê -->
    <div id="s-dashboard">
      <div class="stat-grid">
        <div class="stat-card gold"><div class="stat-ico">üë•</div><div class="stat-num" id="d-total">-</div><div class="stat-label">‡¶Æ‡ßã‡¶ü ‡¶∏‡¶¶‡¶∏‡ßç‡¶Ø</div></div>
        <div class="stat-card green"><div class="stat-ico">‚úÖ</div><div class="stat-num" id="d-approved">-</div><div class="stat-label">‡¶Ö‡¶®‡ßÅ‡¶Æ‡ßã‡¶¶‡¶ø‡¶§</div></div>
        <div class="stat-card red"><div class="stat-ico">‚è≥</div><div class="stat-num" id="d-pending">-</div><div class="stat-label">‡¶™‡ßá‡¶®‡ßç‡¶°‡¶ø‡¶Ç ‡¶Ü‡¶¨‡ßá‡¶¶‡¶®</div></div>
        <div class="stat-card blue"><div class="stat-ico">üì¢</div><div class="stat-num" id="d-notices">-</div><div class="stat-label">‡¶®‡ßã‡¶ü‡¶ø‡¶∂</div></div>
      </div>

      <!-- Recent pending -->
      <div class="table-wrap">
        <div class="table-head"><h3>‚è≥ ‡¶∏‡¶æ‡¶Æ‡ßç‡¶™‡ßç‡¶∞‡¶§‡¶ø‡¶ï ‡¶™‡ßá‡¶®‡ßç‡¶°‡¶ø‡¶Ç ‡¶Ü‡¶¨‡ßá‡¶¶‡¶®</h3>
          <button class="btn btn-g" onclick="goSection('pending')">‡¶∏‡¶¨ ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶® ‚Üí</button></div>
        <div id="dashPendingList"><div class="empty"><div class="empty-ico">‚úÖ</div>‡¶ï‡ßã‡¶®‡ßã ‡¶™‡ßá‡¶®‡ßç‡¶°‡¶ø‡¶Ç ‡¶Ü‡¶¨‡ßá‡¶¶‡¶® ‡¶®‡ßá‡¶á</div></div>
      </div>
    </div>

    <!-- ‚ïê‚ïê PENDING REQUESTS ‚ïê‚ïê -->
    <div id="s-pending" style="display:none">
      <div class="flash flash-ok" id="pFlash"></div>
      <div class="table-wrap">
        <div class="table-head">
          <h3>‚è≥ ‡¶™‡ßá‡¶®‡ßç‡¶°‡¶ø‡¶Ç ‡¶Ü‡¶¨‡ßá‡¶¶‡¶® ‡¶∏‡¶Æ‡ßÇ‡¶π</h3>
          <input class="search-inp" placeholder="üîç ‡¶®‡¶æ‡¶Æ ‡¶¨‡¶æ ‡¶è‡¶≤‡¶æ‡¶ï‡¶æ..." oninput="searchPending(this.value)">
        </div>
        <div id="pendingList"></div>
      </div>
    </div>

    <!-- ‚ïê‚ïê ALL MEMBERS ‚ïê‚ïê -->
    <div id="s-members" style="display:none">
      <div class="flash flash-ok" id="mFlash"></div>
      <div class="page-tabs">
        <button class="ptab active" onclick="switchMemberTab('list',this)">üë• ‡¶∏‡¶¶‡¶∏‡ßç‡¶Ø ‡¶§‡¶æ‡¶≤‡¶ø‡¶ï‡¶æ</button>
        <button class="ptab" onclick="switchMemberTab('add',this)">‚ûï ‡¶®‡¶§‡ßÅ‡¶® ‡¶∏‡¶¶‡¶∏‡ßç‡¶Ø ‡¶Ø‡ßã‡¶ó</button>
      </div>

      <!-- Member Add Panel -->
      <div id="memberAddPanel" style="display:none">
        <div class="form-panel">
          <h4>‚ûï ‡¶®‡¶§‡ßÅ‡¶® ‡¶∏‡¶¶‡¶∏‡ßç‡¶Ø ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶® (Admin ‡¶ï‡¶∞‡ßç‡¶§‡ßÉ‡¶ï)</h4>
          <div class="flash" id="addMemberFlash"></div>
          <div class="grid2">
            <div class="fg"><label>‡¶™‡ßÅ‡¶∞‡ßã ‡¶®‡¶æ‡¶Æ *</label><input type="text" id="am-name" placeholder="‡¶Æ‡ßã‡¶É ..."></div>
            <div class="fg"><label>‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤ ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞ *</label><input type="tel" id="am-phone" placeholder="01XXXXXXXXX"></div>
            <div class="fg"><label>‡¶á‡¶Æ‡ßá‡¶á‡¶≤ *</label><input type="email" id="am-email" placeholder="email@gmail.com"></div>
            <div class="fg"><label>‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° *</label><input type="password" id="am-pass" placeholder="‡¶ï‡¶Æ‡¶™‡¶ï‡ßç‡¶∑‡ßá ‡ß¨ ‡¶Ö‡¶ï‡ßç‡¶∑‡¶∞"></div>
            <div class="fg"><label>‡¶è‡¶≤‡¶æ‡¶ï‡¶æ *</label>
              <select id="am-area">
                <option value="">-- ‡¶è‡¶≤‡¶æ‡¶ï‡¶æ ‡¶¨‡ßá‡¶õ‡ßá ‡¶®‡¶ø‡¶® --</option>
                <option>‡¶ï‡¶æ‡¶®‡ßç‡¶¶‡¶ø‡¶∞‡¶™‡¶æ‡¶°‡¶º‡¶æ</option><option>‡¶á‡¶®‡¶∏‡¶æ‡¶´ ‡¶®‡¶ó‡¶∞</option>
                <option>‡¶ö‡¶æ‡¶á‡¶°‡ßÅ‡¶¨‡¶æ</option><option>‡¶π‡¶≤‡¶¶‡¶æ‡¶∞ ‡¶™‡¶æ‡¶°‡¶º‡¶æ</option>
                <option>‡¶ö‡¶∞‡¶™‡¶æ‡¶°‡¶º‡¶æ</option><option>‡¶Æ‡ßã‡¶π‡¶æ‡¶Æ‡ßç‡¶Æ‡¶¶‡¶™‡ßÅ‡¶∞</option>
                <option>‡¶®‡¶ø‡¶ö‡¶™‡¶æ‡¶°‡¶º‡¶æ</option><option>‡¶∏‡ßã‡¶®‡¶æ‡¶§‡¶≤‡¶æ</option>
              </select>
            </div>
            <div class="fg"><label>‡¶∞‡¶ï‡ßç‡¶§‡ßá‡¶∞ ‡¶ó‡ßç‡¶∞‡ßÅ‡¶™</label>
              <select id="am-blood">
                <option value="">-- ‡¶∞‡¶ï‡ßç‡¶§‡ßá‡¶∞ ‡¶ó‡ßç‡¶∞‡ßÅ‡¶™ --</option>
                <option>A+</option><option>A-</option><option>B+</option><option>B-</option>
                <option>AB+</option><option>AB-</option><option>O+</option><option>O-</option>
              </select>
            </div>
            <div class="fg"><label>‡¶≤‡¶ø‡¶ô‡ßç‡¶ó</label>
              <select id="am-gender">
                <option value="‡¶™‡ßÅ‡¶∞‡ßÅ‡¶∑">‡¶™‡ßÅ‡¶∞‡ßÅ‡¶∑</option>
                <option value="‡¶Æ‡¶π‡¶ø‡¶≤‡¶æ">‡¶Æ‡¶π‡¶ø‡¶≤‡¶æ</option>
              </select>
            </div>
            <div class="fg"><label>‡¶ú‡¶®‡ßç‡¶Æ ‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ</label><input type="date" id="am-dob"></div>
            <div class="fg"><label>‡¶™‡¶¶‡¶¨‡¶ø</label>
              <select id="am-position">
                <option value="‡¶∏‡¶¶‡¶∏‡ßç‡¶Ø">‡¶∏‡¶¶‡¶∏‡ßç‡¶Ø</option>
                <option value="‡¶∏‡¶≠‡¶æ‡¶™‡¶§‡¶ø">‡¶∏‡¶≠‡¶æ‡¶™‡¶§‡¶ø</option>
                <option value="‡¶∏‡¶æ‡¶ß‡¶æ‡¶∞‡¶£ ‡¶∏‡¶Æ‡ßç‡¶™‡¶æ‡¶¶‡¶ï">‡¶∏‡¶æ‡¶ß‡¶æ‡¶∞‡¶£ ‡¶∏‡¶Æ‡ßç‡¶™‡¶æ‡¶¶‡¶ï</option>
                <option value="‡¶∏‡¶π-‡¶∏‡¶≠‡¶æ‡¶™‡¶§‡¶ø">‡¶∏‡¶π-‡¶∏‡¶≠‡¶æ‡¶™‡¶§‡¶ø</option>
                <option value="‡¶ï‡ßã‡¶∑‡¶æ‡¶ß‡ßç‡¶Ø‡¶ï‡ßç‡¶∑">‡¶ï‡ßã‡¶∑‡¶æ‡¶ß‡ßç‡¶Ø‡¶ï‡ßç‡¶∑</option>
                <option value="‡¶ï‡¶æ‡¶∞‡ßç‡¶Ø‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶π‡ßÄ ‡¶∏‡¶¶‡¶∏‡ßç‡¶Ø">‡¶ï‡¶æ‡¶∞‡ßç‡¶Ø‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶π‡ßÄ ‡¶∏‡¶¶‡¶∏‡ßç‡¶Ø</option>
              </select>
            </div>
          </div>
          <div class="fg"><label>‡¶†‡¶ø‡¶ï‡¶æ‡¶®‡¶æ</label><input type="text" id="am-address" placeholder="‡¶¨‡¶ø‡¶∏‡ßç‡¶§‡¶æ‡¶∞‡¶ø‡¶§ ‡¶†‡¶ø‡¶ï‡¶æ‡¶®‡¶æ"></div>
          <div class="fg"><label>‡¶õ‡¶¨‡¶ø (‡¶ê‡¶ö‡ßç‡¶õ‡¶ø‡¶ï)</label>
            <input type="file" id="am-photo" accept="image/*" onchange="previewAddMemberPhoto(this)">
            <div id="amPhotoPreview" class="img-preview-wrap"></div>
          </div>
          <div style="display:flex;gap:10px;flex-wrap:wrap;margin-top:4px">
            <button class="btn btn-g btn-lg" onclick="addMemberByAdmin()">‚úÖ ‡¶∏‡¶¶‡¶∏‡ßç‡¶Ø ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®</button>
            <button class="btn btn-b btn-lg" onclick="switchMemberTab('list',document.querySelector('.ptab'))">‚Üê ‡¶´‡¶ø‡¶∞‡ßá ‡¶Ø‡¶æ‡¶®</button>
          </div>
        </div>
      </div>

      <!-- Member List Panel -->
      <div id="memberListPanel">
      <div class="table-wrap">
        <div class="table-head">
          <h3>üë• ‡¶∏‡¶ï‡¶≤ ‡¶∏‡¶¶‡¶∏‡ßç‡¶Ø</h3>
          <input class="search-inp" placeholder="üîç ‡¶®‡¶æ‡¶Æ, ‡¶è‡¶≤‡¶æ‡¶ï‡¶æ, ‡¶´‡ßã‡¶®..." oninput="searchMembers(this.value)">
        </div>
        <div style="overflow-x:auto">
        <table>
          <thead><tr>
            <th>‡¶∏‡¶¶‡¶∏‡ßç‡¶Ø</th><th>ID</th><th>‡¶è‡¶≤‡¶æ‡¶ï‡¶æ</th><th>‡¶´‡ßã‡¶®</th><th>‡¶™‡¶¶‡¶¨‡¶ø</th><th>‡¶∞‡¶ï‡ßç‡¶§</th><th>‡¶Ö‡¶¨‡¶∏‡ßç‡¶•‡¶æ</th><th>‡¶ï‡¶æ‡¶∞‡ßç‡¶Ø‡¶ï‡ßç‡¶∞‡¶Æ</th>
          </tr></thead>
          <tbody id="memberTableBody"></tbody>
        </table>
        </div>
      </div>
      </div><!-- /memberListPanel -->
    </div>

    <!-- ‚ïê‚ïê ADMIN MANAGEMENT ‚ïê‚ïê -->
    <div id="s-admins" style="display:none">
      <div class="flash flash-ok" id="aFlash"></div>
      <div class="form-panel">
        <h4>üîë ‡¶®‡¶§‡ßÅ‡¶® Admin ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®</h4>
        <div class="grid2">
          <div class="fg"><label>‡¶∏‡¶¶‡¶∏‡ßç‡¶Ø ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</label>
            <select id="adminSelectMember"><option value="">-- ‡¶∏‡¶¶‡¶∏‡ßç‡¶Ø ‡¶¨‡ßá‡¶õ‡ßá ‡¶®‡¶ø‡¶® --</option></select>
          </div>
          <div class="fg"><label>Role</label>
            <select id="adminRole">
              <option value="admin">Admin</option>
              <option value="superadmin">Super Admin</option>
            </select>
          </div>
        </div>
        <button class="btn btn-g btn-lg" onclick="makeAdmin()">üîë Admin ‡¶ï‡¶∞‡ßÅ‡¶®</button>
      </div>
      <div class="table-wrap">
        <div class="table-head"><h3>üîë ‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶® Admin‡¶ó‡¶£</h3></div>
        <div style="overflow-x:auto">
        <table>
          <thead><tr><th>‡¶∏‡¶¶‡¶∏‡ßç‡¶Ø</th><th>‡¶á‡¶Æ‡ßá‡¶á‡¶≤</th><th>Role</th><th>‡¶ï‡¶æ‡¶∞‡ßç‡¶Ø‡¶ï‡ßç‡¶∞‡¶Æ</th></tr></thead>
          <tbody id="adminTableBody"></tbody>
        </table>
        </div>
      </div>
    </div>

    <!-- ‚ïê‚ïê NOTICES ‚ïê‚ïê -->
    <div id="s-notices" style="display:none">
      <div class="flash flash-ok" id="nFlash"></div>
      <div class="page-tabs">
        <button class="ptab active" onclick="switchNoticeTab('list',this)">üìã ‡¶®‡ßã‡¶ü‡¶ø‡¶∂ ‡¶§‡¶æ‡¶≤‡¶ø‡¶ï‡¶æ</button>
        <button class="ptab" onclick="switchNoticeTab('add',this)">‚ûï ‡¶®‡¶§‡ßÅ‡¶® ‡¶®‡ßã‡¶ü‡¶ø‡¶∂</button>
      </div>

      <!-- Notice List -->
      <div id="noticeListPanel">
        <div class="table-wrap">
          <div class="table-head"><h3>üì¢ ‡¶∏‡¶ï‡¶≤ ‡¶®‡ßã‡¶ü‡¶ø‡¶∂</h3></div>
          <div id="noticeList"></div>
        </div>
      </div>

      <!-- Add Notice -->
      <div id="noticeAddPanel" style="display:none">
        <div class="form-panel">
          <h4 id="noticeFormTitle">‚ûï ‡¶®‡¶§‡ßÅ‡¶® ‡¶®‡ßã‡¶ü‡¶ø‡¶∂ ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®</h4>
          <input type="hidden" id="editNoticeId">
          <div class="fg"><label>‡¶∂‡¶ø‡¶∞‡ßã‡¶®‡¶æ‡¶Æ *</label><input type="text" id="n-title" placeholder="‡¶®‡ßã‡¶ü‡¶ø‡¶∂‡ßá‡¶∞ ‡¶∂‡¶ø‡¶∞‡ßã‡¶®‡¶æ‡¶Æ"></div>
          <div class="fg"><label>‡¶¨‡¶ø‡¶¨‡¶∞‡¶£ *</label><textarea id="n-body" placeholder="‡¶®‡ßã‡¶ü‡¶ø‡¶∂‡ßá‡¶∞ ‡¶¨‡¶ø‡¶∏‡ßç‡¶§‡¶æ‡¶∞‡¶ø‡¶§..."></textarea></div>
          <div class="grid3">
            <div class="fg"><label>‡¶ß‡¶∞‡¶®</label>
              <select id="n-type">
                <option value="default">‡¶∏‡¶æ‡¶ß‡¶æ‡¶∞‡¶£</option>
                <option value="urgent">‡¶ú‡¶∞‡ßÅ‡¶∞‡¶ø</option>
                <option value="info">‡¶§‡¶•‡ßç‡¶Ø</option>
                <option value="success">‡¶∏‡¶´‡¶≤‡¶§‡¶æ</option>
              </select>
            </div>
            <div class="fg"><label>‡¶õ‡¶¨‡¶ø (‡¶ê‡¶ö‡ßç‡¶õ‡¶ø‡¶ï)</label><input type="file" id="n-photo" accept="image/*"></div>
          </div>
          <div style="display:flex;gap:10px;flex-wrap:wrap;">
            <button class="btn btn-g btn-lg" onclick="saveNotice()">üíæ ‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶£ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
            <button class="btn btn-b btn-lg" onclick="switchNoticeTab('list',document.querySelector('.ptab'))">‚Üê ‡¶´‡¶ø‡¶∞‡ßá ‡¶Ø‡¶æ‡¶®</button>
          </div>
        </div>
      </div>
    </div>

    <!-- ‚ïê‚ïê GALLERY ‚ïê‚ïê -->
    <div id="s-gallery" style="display:none">
      <div class="flash flash-ok" id="gFlash"></div>
      <div class="page-tabs">
        <button class="ptab active" onclick="switchGalTab('list',this)">üì∑ ‡¶ó‡ßç‡¶Ø‡¶æ‡¶≤‡¶æ‡¶∞‡¶ø</button>
        <button class="ptab" onclick="switchGalTab('add',this)">‚ûï ‡¶õ‡¶¨‡¶ø ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®</button>
      </div>
      <div id="galListPanel">
        <div id="galAdminGrid" style="display:grid;grid-template-columns:repeat(auto-fill,minmax(180px,1fr));gap:14px;"></div>
      </div>
      <div id="galAddPanel" style="display:none">
        <div class="form-panel">
          <h4>üì∑ ‡¶®‡¶§‡ßÅ‡¶® ‡¶õ‡¶¨‡¶ø ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®</h4>
          <div class="fg"><label>‡¶õ‡¶¨‡¶ø *</label><input type="file" id="g-photo" accept="image/*" onchange="previewGalPhoto(this)"><div id="galPreviewWrap" class="img-preview-wrap"></div></div>
          <div class="fg"><label>‡¶¨‡¶ø‡¶¨‡¶∞‡¶£ *</label><input type="text" id="g-caption" placeholder="‡¶õ‡¶¨‡¶ø‡¶∞ ‡¶¨‡¶ø‡¶¨‡¶∞‡¶£"></div>
          <div class="fg"><label>‡¶ï‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶ó‡¶∞‡¶ø</label>
            <select id="g-cat">
              <option value="event">‡¶Ö‡¶®‡ßÅ‡¶∑‡ßç‡¶†‡¶æ‡¶®</option><option value="tree">‡¶¨‡ßÉ‡¶ï‡ßç‡¶∑‡¶∞‡ßã‡¶™‡¶£</option>
              <option value="edu">‡¶∂‡¶ø‡¶ï‡ßç‡¶∑‡¶æ</option><option value="blood">‡¶∞‡¶ï‡ßç‡¶§‡¶¶‡¶æ‡¶®</option>
              <option value="relief">‡¶∏‡¶π‡¶æ‡¶Ø‡¶º‡¶§‡¶æ</option>
            </select>
          </div>
          <button class="btn btn-g btn-lg" onclick="uploadGalleryPhoto()">üì§ ‡¶Ü‡¶™‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡ßÅ‡¶®</button>
        </div>
      </div>
    </div>

    <!-- ‚ïê‚ïê STATS ‚ïê‚ïê -->
    <div id="s-stats" style="display:none">
      <div class="flash flash-ok" id="stFlash"></div>
      <div class="form-panel">
        <h4>üìà ‡¶™‡¶∞‡¶ø‡¶∏‡¶Ç‡¶ñ‡ßç‡¶Ø‡¶æ‡¶® ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®</h4>
        <div class="grid2">
          <div class="fg"><label>‡¶∏‡¶ï‡ßç‡¶∞‡¶ø‡¶Ø‡¶º ‡¶∏‡¶¶‡¶∏‡ßç‡¶Ø</label><input type="number" id="st-members" placeholder="‡¶Ø‡ßá‡¶Æ‡¶®: 25"></div>
          <div class="fg"><label>‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ‡ßá‡¶∞ ‡¶∂‡¶æ‡¶ñ‡¶æ</label><input type="number" id="st-branches" placeholder="‡¶Ø‡ßá‡¶Æ‡¶®: 6"></div>
          <div class="fg"><label>‡¶∏‡¶Æ‡¶æ‡¶ú ‡¶ï‡¶æ‡¶∞‡ßç‡¶Ø‡¶ï‡ßç‡¶∞‡¶Æ</label><input type="number" id="st-activities" placeholder="‡¶Ø‡ßá‡¶Æ‡¶®: 50"></div>
          <div class="fg"><label>‡¶¨‡¶õ‡¶∞‡ßá‡¶∞ ‡¶Ö‡¶≠‡¶ø‡¶ú‡ßç‡¶û‡¶§‡¶æ</label><input type="number" id="st-years" placeholder="‡¶Ø‡ßá‡¶Æ‡¶®: 1"></div>
          <div class="fg"><label>‡¶∂‡¶ø‡¶ï‡ßç‡¶∑‡¶æ‡¶∞‡ßç‡¶•‡ßÄ ‡¶∏‡¶π‡¶æ‡¶Ø‡¶º‡¶§‡¶æ</label><input type="number" id="st-students" placeholder="‡¶Ø‡ßá‡¶Æ‡¶®: 15"></div>
          <div class="fg"><label>‡¶ó‡¶æ‡¶õ ‡¶∞‡ßã‡¶™‡¶£</label><input type="number" id="st-trees" placeholder="‡¶Ø‡ßá‡¶Æ‡¶®: 120"></div>
          <div class="fg"><label>‡¶∞‡¶ï‡ßç‡¶§‡¶¶‡¶æ‡¶® ‡¶á‡¶â‡¶®‡¶ø‡¶ü</label><input type="number" id="st-blood" placeholder="‡¶Ø‡ßá‡¶Æ‡¶®: 20"></div>
          <div class="fg"><label>‡¶™‡¶∞‡¶ø‡¶¨‡¶æ‡¶∞ ‡¶∏‡¶π‡¶æ‡¶Ø‡¶º‡¶§‡¶æ</label><input type="number" id="st-families" placeholder="‡¶Ø‡ßá‡¶Æ‡¶®: 50"></div>
        </div>
        <button class="btn btn-g btn-lg" onclick="saveStats()">üíæ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®</button>
      </div>
    </div>

  </div><!-- /content -->
</div><!-- /main -->

<!-- Profile Edit Modal (Super Admin only) -->
<div id="profileEditModal" style="display:none;position:fixed;inset:0;background:rgba(0,0,0,.75);z-index:600;padding:20px;overflow-y:auto;display:none;align-items:center;justify-content:center;">
  <div style="background:rgba(13,46,13,.97);border:1px solid var(--b2);border-radius:20px;max-width:560px;width:100%;padding:28px;position:relative;margin:auto;">
    <button onclick="document.getElementById('profileEditModal').style.display='none'" style="position:absolute;top:14px;right:14px;background:var(--glass2);border:1px solid var(--b1);color:#fff;width:30px;height:30px;border-radius:50%;cursor:pointer;font-size:14px;">‚úï</button>
    <h3 style="color:var(--sgold);font-size:1.1rem;font-weight:700;margin-bottom:18px;padding-bottom:10px;border-bottom:1px solid rgba(255,255,255,.06)">‚úèÔ∏è ‡¶∏‡¶¶‡¶∏‡ßç‡¶Ø ‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤ ‡¶∏‡¶Æ‡ßç‡¶™‡¶æ‡¶¶‡¶®‡¶æ</h3>
    <div class="flash" id="editProfileFlash"></div>
    <input type="hidden" id="ep-uid">
    <div class="grid2">
      <div class="fg"><label>‡¶™‡ßÅ‡¶∞‡ßã ‡¶®‡¶æ‡¶Æ</label><input type="text" id="ep-name"></div>
      <div class="fg"><label>‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤</label><input type="tel" id="ep-phone"></div>
      <div class="fg"><label>‡¶è‡¶≤‡¶æ‡¶ï‡¶æ</label>
        <select id="ep-area">
          <option value="">-- ‡¶è‡¶≤‡¶æ‡¶ï‡¶æ --</option>
          <option>‡¶ï‡¶æ‡¶®‡ßç‡¶¶‡¶ø‡¶∞‡¶™‡¶æ‡¶°‡¶º‡¶æ</option><option>‡¶á‡¶®‡¶∏‡¶æ‡¶´ ‡¶®‡¶ó‡¶∞</option>
          <option>‡¶ö‡¶æ‡¶á‡¶°‡ßÅ‡¶¨‡¶æ</option><option>‡¶π‡¶≤‡¶¶‡¶æ‡¶∞ ‡¶™‡¶æ‡¶°‡¶º‡¶æ</option>
          <option>‡¶ö‡¶∞‡¶™‡¶æ‡¶°‡¶º‡¶æ</option><option>‡¶Æ‡ßã‡¶π‡¶æ‡¶Æ‡ßç‡¶Æ‡¶¶‡¶™‡ßÅ‡¶∞</option>
          <option>‡¶®‡¶ø‡¶ö‡¶™‡¶æ‡¶°‡¶º‡¶æ</option><option>‡¶∏‡ßã‡¶®‡¶æ‡¶§‡¶≤‡¶æ</option>
        </select>
      </div>
      <div class="fg"><label>‡¶∞‡¶ï‡ßç‡¶§‡ßá‡¶∞ ‡¶ó‡ßç‡¶∞‡ßÅ‡¶™</label>
        <select id="ep-blood">
          <option value="">--</option>
          <option>A+</option><option>A-</option><option>B+</option><option>B-</option>
          <option>AB+</option><option>AB-</option><option>O+</option><option>O-</option>
        </select>
      </div>
      <div class="fg"><label>‡¶™‡¶¶‡¶¨‡¶ø</label>
        <select id="ep-position">
          <option value="‡¶∏‡¶¶‡¶∏‡ßç‡¶Ø">‡¶∏‡¶¶‡¶∏‡ßç‡¶Ø</option>
          <option value="‡¶∏‡¶≠‡¶æ‡¶™‡¶§‡¶ø">‡¶∏‡¶≠‡¶æ‡¶™‡¶§‡¶ø</option>
          <option value="‡¶∏‡¶æ‡¶ß‡¶æ‡¶∞‡¶£ ‡¶∏‡¶Æ‡ßç‡¶™‡¶æ‡¶¶‡¶ï">‡¶∏‡¶æ‡¶ß‡¶æ‡¶∞‡¶£ ‡¶∏‡¶Æ‡ßç‡¶™‡¶æ‡¶¶‡¶ï</option>
          <option value="‡¶∏‡¶π-‡¶∏‡¶≠‡¶æ‡¶™‡¶§‡¶ø">‡¶∏‡¶π-‡¶∏‡¶≠‡¶æ‡¶™‡¶§‡¶ø</option>
          <option value="‡¶ï‡ßã‡¶∑‡¶æ‡¶ß‡ßç‡¶Ø‡¶ï‡ßç‡¶∑">‡¶ï‡ßã‡¶∑‡¶æ‡¶ß‡ßç‡¶Ø‡¶ï‡ßç‡¶∑</option>
          <option value="‡¶ï‡¶æ‡¶∞‡ßç‡¶Ø‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶π‡ßÄ ‡¶∏‡¶¶‡¶∏‡ßç‡¶Ø">‡¶ï‡¶æ‡¶∞‡ßç‡¶Ø‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶π‡ßÄ ‡¶∏‡¶¶‡¶∏‡ßç‡¶Ø</option>
        </select>
      </div>
      <div class="fg"><label>‡¶ú‡¶®‡ßç‡¶Æ ‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ</label><input type="date" id="ep-dob"></div>
    </div>
    <div class="fg"><label>‡¶†‡¶ø‡¶ï‡¶æ‡¶®‡¶æ</label><input type="text" id="ep-address"></div>
    <div class="fg"><label>Member ID</label><input type="text" id="ep-memberid" placeholder="‡¶Ø‡ßá‡¶Æ‡¶®: 2025-001"></div>
    <div style="display:flex;gap:10px;margin-top:8px;flex-wrap:wrap">
      <button class="btn btn-g btn-lg" onclick="saveProfileEdit()">üíæ ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶® ‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶£</button>
      <button class="btn btn-b btn-lg" onclick="document.getElementById('profileEditModal').style.display='none'">‡¶¨‡¶æ‡¶§‡¶ø‡¶≤</button>
    </div>
  </div>
</div>

<!-- Member Detail Modal -->
<div id="memberDetailModal" style="display:none;position:fixed;inset:0;background:rgba(0,0,0,.7);z-index:500;padding:20px;overflow-y:auto;display:flex;align-items:center;justify-content:center;">
  <div style="background:rgba(13,46,13,.97);border:1px solid var(--b2);border-radius:20px;max-width:500px;width:100%;padding:28px;position:relative;">
    <button onclick="document.getElementById('memberDetailModal').style.display='none'" style="position:absolute;top:14px;right:14px;background:var(--glass2);border:1px solid var(--b1);color:#fff;width:30px;height:30px;border-radius:50%;cursor:pointer;font-size:14px;">‚úï</button>
    <div id="memberDetailContent"></div>
    <div id="memberDetailActions" style="display:flex;gap:10px;margin-top:16px;flex-wrap:wrap;"></div>
  </div>
</div>

<!-- Firebase SDK -->
<script type="module">
import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js';
import { getAuth, onAuthStateChanged, signOut } from 'https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js';
import { getFirestore, collection, doc, getDoc, getDocs, setDoc, updateDoc, deleteDoc, query, where, orderBy, onSnapshot, serverTimestamp, addDoc, limit } from 'https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js';

const firebaseConfig = {
  apiKey: "AIzaSyDwzJgWcc4XPt4czcXpVFkHTniJFISpO7I",
  authDomain: "somaj-kallyan.firebaseapp.com",
  projectId: "somaj-kallyan",
  appId: "1:392871962816:web:0f7ebbc36a3d8c784da525"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

const CLOUDINARY_URL = 'https://api.cloudinary.com/v1_1/dasurbavl/image/upload';
const UPLOAD_PRESET = 'somaj-kallyan-upload';
const SUPER_ADMIN = 'issaidur999@gmail.com';

let currentUser = null;
let currentUserData = null;
let allMembers = [];
let allPending = [];

// ‚îÄ‚îÄ Auth Guard
onAuthStateChanged(auth, async (user) => {
  if (!user) { window.location.href = 'login.html'; return; }
  const userDoc = await getDoc(doc(db, 'users', user.uid));
  if (!userDoc.exists()) { window.location.href = 'login.html'; return; }
  const data = userDoc.data();
  if (data.status !== 'approved' || (data.role !== 'admin' && data.role !== 'superadmin')) {
    window.location.href = 'login.html'; return;
  }
  currentUser = user;
  currentUserData = data;
  initAdmin(data);
});

function initAdmin(data) {
  document.getElementById('sidebarName').textContent = data.name || currentUser?.email || 'Admin';
  document.getElementById('sidebarRole').textContent = data.role === 'superadmin' ? 'Super Admin' : 'Admin';
  document.getElementById('adminBadge').textContent = data.role === 'superadmin' ? '‚≠ê Super Admin' : 'üîë Admin';
  if (data.photoUrl) {
    document.getElementById('sidebarAv').innerHTML = `<img src="${data.photoUrl}" style="width:100%;height:100%;object-fit:cover;border-radius:50%">`;
  } else {
    document.getElementById('sidebarAv').textContent = (data.name||'A').charAt(0);
  }
  // Hide admin management for non-superadmin
  if (data.role !== 'superadmin') document.getElementById('nav-admins').style.display = 'none';

  loadDashboard();
  loadPending();
  // loadMembers ‡¶Ü‡¶ó‡ßá call ‡¶ï‡¶∞‡ßã ‡¶Ø‡¶æ‡¶§‡ßá adminSelectMember dropdown populate ‡¶π‡¶Ø‡¶º
  loadMembers().then(() => {
    if (data.role === 'superadmin') loadAdmins();
  });
  loadNotices();
  loadGallery();
  loadStats();
}

// ‚îÄ‚îÄ DASHBOARD
async function loadDashboard() {
  const usersSnap = await getDocs(collection(db, 'users'));
  const pendSnap = await getDocs(query(collection(db, 'users'), where('status','==','pending')));
  const approvedSnap = await getDocs(query(collection(db, 'users'), where('status','==','approved')));
  const noticesSnap = await getDocs(collection(db, 'notices'));

  document.getElementById('d-total').textContent = usersSnap.size;
  document.getElementById('d-approved').textContent = approvedSnap.size;
  document.getElementById('d-pending').textContent = pendSnap.size;
  document.getElementById('d-notices').textContent = noticesSnap.size;
  document.getElementById('pendingBadge').textContent = pendSnap.size;

  // Recent pending list
  const pend = pendSnap.docs.slice(0,5).map(d => d.data());
  const dashPendingList = document.getElementById('dashPendingList');
  if (pend.length === 0) {
    dashPendingList.innerHTML = '<div class="empty"><div class="empty-ico">‚úÖ</div>‡¶ï‡ßã‡¶®‡ßã ‡¶™‡ßá‡¶®‡ßç‡¶°‡¶ø‡¶Ç ‡¶Ü‡¶¨‡ßá‡¶¶‡¶® ‡¶®‡ßá‡¶á</div>';
    return;
  }
  dashPendingList.innerHTML = `<div style="overflow-x:auto"><table>
    <thead><tr><th>‡¶∏‡¶¶‡¶∏‡ßç‡¶Ø</th><th>‡¶è‡¶≤‡¶æ‡¶ï‡¶æ</th><th>‡¶´‡ßã‡¶®</th><th>‡¶ï‡¶æ‡¶∞‡ßç‡¶Ø‡¶ï‡ßç‡¶∞‡¶Æ</th></tr></thead>
    <tbody>${pend.map(m=>`<tr>
      <td><div class="mem-info">
        <div class="mem-av">${m.photoUrl?`<img src="${m.photoUrl}" style="width:100%;height:100%;object-fit:cover;border-radius:50%">`:m.name.charAt(0)}</div>
        <div><div class="mem-name">${m.name}</div><div class="mem-sub">${m.email||''}</div></div>
      </div></td>
      <td>${m.area||'-'}</td>
      <td>${m.phone||'-'}</td>
      <td><button class="btn btn-g" onclick="approveUser('${m.uid}')">‚úÖ ‡¶Ö‡¶®‡ßÅ‡¶Æ‡ßã‡¶¶‡¶®</button>
      <button class="btn btn-r" style="margin-left:6px" onclick="rejectUser('${m.uid}')">‚ùå ‡¶™‡ßç‡¶∞‡¶§‡ßç‡¶Ø‡¶æ‡¶ñ‡ßç‡¶Ø‡¶æ‡¶®</button></td>
    </tr>`).join('')}</tbody>
  </table></div>`;
}

// ‚îÄ‚îÄ PENDING REQUESTS
async function loadPending() {
  const snap = await getDocs(query(collection(db, 'users'), where('status','==','pending')));
  allPending = snap.docs.map(d => ({...d.data(), uid: d.id}));
  renderPending(allPending);
}

function renderPending(list) {
  const el = document.getElementById('pendingList');
  if (list.length === 0) { el.innerHTML = '<div class="empty"><div class="empty-ico">‚úÖ</div>‡¶ï‡ßã‡¶®‡ßã ‡¶™‡ßá‡¶®‡ßç‡¶°‡¶ø‡¶Ç ‡¶Ü‡¶¨‡ßá‡¶¶‡¶® ‡¶®‡ßá‡¶á</div>'; return; }
  el.innerHTML = `<div style="overflow-x:auto"><table>
    <thead><tr><th>‡¶∏‡¶¶‡¶∏‡ßç‡¶Ø</th><th>‡¶è‡¶≤‡¶æ‡¶ï‡¶æ</th><th>‡¶´‡ßã‡¶®</th><th>‡¶∞‡¶ï‡ßç‡¶§</th><th>‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ</th><th>‡¶ï‡¶æ‡¶∞‡ßç‡¶Ø‡¶ï‡ßç‡¶∞‡¶Æ</th></tr></thead>
    <tbody>${list.map(m=>`<tr>
      <td><div class="mem-info">
        <div class="mem-av">${m.photoUrl?`<img src="${m.photoUrl}" style="width:100%;height:100%;object-fit:cover;border-radius:50%">`:m.name.charAt(0)}</div>
        <div><div class="mem-name">${m.name}</div><div class="mem-sub">${m.email||''}</div></div>
      </div></td>
      <td>${m.area||'-'}</td><td>${m.phone||'-'}</td><td>${m.bloodGroup||'-'}</td>
      <td>${m.createdAt?.seconds?new Date(m.createdAt.seconds*1000).toLocaleDateString('bn-BD'):'-'}</td>
      <td style="display:flex;gap:6px;flex-wrap:wrap">
        <button class="btn btn-g" onclick="approveUser('${m.uid}')">‚úÖ ‡¶Ö‡¶®‡ßÅ‡¶Æ‡ßã‡¶¶‡¶®</button>
        <button class="btn btn-r" onclick="rejectUser('${m.uid}')">‚ùå ‡¶™‡ßç‡¶∞‡¶§‡ßç‡¶Ø‡¶æ‡¶ñ‡ßç‡¶Ø‡¶æ‡¶®</button>
        <button class="btn btn-b" onclick="viewMember('${m.uid}')">üëÅ ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®</button>
      </td>
    </tr>`).join('')}</tbody>
  </table></div>`;
}

window.searchPending = function(q) {
  const f = allPending.filter(m => m.name?.toLowerCase().includes(q.toLowerCase()) || m.area?.toLowerCase().includes(q.toLowerCase()));
  renderPending(f);
};

// ‚îÄ‚îÄ MEMBERS
async function loadMembers() {
  const snap = await getDocs(query(collection(db, 'users'), where('status','==','approved')));
  allMembers = snap.docs.map(d => ({...d.data(), uid: d.id}));
  renderMembers(allMembers);
  // Also populate admin select
  const sel = document.getElementById('adminSelectMember');
  if (sel) {
    sel.innerHTML = '<option value="">-- ‡¶∏‡¶¶‡¶∏‡ßç‡¶Ø ‡¶¨‡ßá‡¶õ‡ßá ‡¶®‡¶ø‡¶® --</option>';
    allMembers.filter(m=>m.role==='member').forEach(m => {
      sel.innerHTML += `<option value="${m.uid}">${m.name} ‚Äî ${m.area||''}</option>`;
    });
  }
}

function renderMembers(list) {
  const tbody = document.getElementById('memberTableBody');
  if (!tbody) return;
  if (list.length === 0) { tbody.innerHTML = '<tr><td colspan="8" style="text-align:center;padding:30px;color:rgba(255,255,255,.3)">‡¶ï‡ßã‡¶®‡ßã ‡¶∏‡¶¶‡¶∏‡ßç‡¶Ø ‡¶®‡ßá‡¶á</td></tr>'; return; }
  tbody.innerHTML = list.map(m=>`<tr>
    <td><div class="mem-info">
      <div class="mem-av">${m.photoUrl?`<img src="${m.photoUrl}" style="width:100%;height:100%;object-fit:cover;border-radius:50%">`:m.name?.charAt(0)||'?'}</div>
      <div><div class="mem-name">${m.name||'-'}</div><div class="mem-sub">${m.email||''}</div></div>
    </div></td>
    <td>${m.memberId||'‚Äî'}</td>
    <td>${m.area||'-'}</td>
    <td>${m.phone||'-'}</td>
    <td><select onchange="updatePosition('${m.uid}',this.value)" style="background:var(--glass2);border:1px solid var(--b1);color:#fff;padding:4px 8px;border-radius:6px;font-size:12px;font-family:inherit;outline:none;">
      ${['‡¶∏‡¶¶‡¶∏‡ßç‡¶Ø','‡¶∏‡¶≠‡¶æ‡¶™‡¶§‡¶ø','‡¶∏‡¶æ‡¶ß‡¶æ‡¶∞‡¶£ ‡¶∏‡¶Æ‡ßç‡¶™‡¶æ‡¶¶‡¶ï','‡¶∏‡¶π-‡¶∏‡¶≠‡¶æ‡¶™‡¶§‡¶ø','‡¶ï‡ßã‡¶∑‡¶æ‡¶ß‡ßç‡¶Ø‡¶ï‡ßç‡¶∑','‡¶ï‡¶æ‡¶∞‡ßç‡¶Ø‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶π‡ßÄ ‡¶∏‡¶¶‡¶∏‡ßç‡¶Ø'].map(p=>`<option value="${p}"${m.position===p?' selected':''}>${p}</option>`).join('')}
    </select></td>
    <td>${m.bloodGroup||'-'}</td>
    <td><span class="badge ${m.role==='superadmin'?'b-superadmin':m.role==='admin'?'b-admin':'b-approved'}">${m.role==='superadmin'?'Super Admin':m.role==='admin'?'Admin':'‡¶∏‡¶¶‡¶∏‡ßç‡¶Ø'}</span></td>
    <td style="display:flex;gap:6px;flex-wrap:wrap;">
      <button class="btn btn-b" onclick="viewMember('${m.uid}')">üëÅ</button>
      <button class="btn btn-g" onclick="openProfileEdit('${m.uid}')">‚úèÔ∏è</button>
      <button class="btn btn-r" onclick="removeMember('${m.uid}')">üóë</button>
    </td>
  </tr>`).join('');
}

window.searchMembers = function(q) {
  const f = allMembers.filter(m =>
    m.name?.toLowerCase().includes(q.toLowerCase()) ||
    m.area?.toLowerCase().includes(q.toLowerCase()) ||
    m.phone?.includes(q) ||
    m.memberId?.includes(q)
  );
  renderMembers(f);
};

// ‚îÄ‚îÄ APPROVE / REJECT
window.approveUser = async function(uid) {
  if (!confirm('‡¶è‡¶á ‡¶∏‡¶¶‡¶∏‡ßç‡¶Ø‡¶ï‡ßá ‡¶Ö‡¶®‡ßÅ‡¶Æ‡ßã‡¶¶‡¶® ‡¶ï‡¶∞‡¶¨‡ßá‡¶®?')) return;
  // Generate member ID: year-serial
  const year = new Date().getFullYear();
  const approvedSnap = await getDocs(query(collection(db,'users'),where('status','==','approved')));
  const serial = String(approvedSnap.size + 1).padStart(3, '0');
  const memberId = `${year}-${serial}`;

  await updateDoc(doc(db,'users',uid), {
    status: 'approved', memberId, approvedAt: serverTimestamp(), updatedAt: serverTimestamp()
  });
  // Remove from pending requests
  try { await deleteDoc(doc(db,'pendingRequests',uid)); } catch(e){}

  flash('pFlash', `‚úÖ ‡¶∏‡¶¶‡¶∏‡ßç‡¶Ø ‡¶Ö‡¶®‡ßÅ‡¶Æ‡ßã‡¶¶‡¶ø‡¶§ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§ ID: ${memberId}`);
  flash('mFlash', `‚úÖ ‡¶∏‡¶¶‡¶∏‡ßç‡¶Ø ‡¶Ö‡¶®‡ßÅ‡¶Æ‡ßã‡¶¶‡¶ø‡¶§‡•§ ID: ${memberId}`);
  loadPending(); loadMembers(); loadDashboard();
};

window.rejectUser = async function(uid) {
  if (!confirm('‡¶è‡¶á ‡¶Ü‡¶¨‡ßá‡¶¶‡¶® ‡¶™‡ßç‡¶∞‡¶§‡ßç‡¶Ø‡¶æ‡¶ñ‡ßç‡¶Ø‡¶æ‡¶® ‡¶ï‡¶∞‡¶¨‡ßá‡¶®?')) return;
  await updateDoc(doc(db,'users',uid), {status:'rejected', updatedAt: serverTimestamp()});
  try { await deleteDoc(doc(db,'pendingRequests',uid)); } catch(e){}
  flash('pFlash','‚ùå ‡¶Ü‡¶¨‡ßá‡¶¶‡¶® ‡¶™‡ßç‡¶∞‡¶§‡ßç‡¶Ø‡¶æ‡¶ñ‡ßç‡¶Ø‡¶æ‡¶® ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§');
  loadPending(); loadDashboard();
};

window.updatePosition = async function(uid, pos) {
  await updateDoc(doc(db,'users',uid), {position: pos, updatedAt: serverTimestamp()});
};

window.removeMember = async function(uid) {
  if (!confirm('‡¶è‡¶á ‡¶∏‡¶¶‡¶∏‡ßç‡¶Ø‡¶ï‡ßá ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶¨‡ßá‡¶®? ‡¶è‡¶ü‡¶ø ‡¶™‡ßÇ‡¶∞‡ßç‡¶¨‡¶æ‡¶¨‡¶∏‡ßç‡¶•‡¶æ‡¶Ø‡¶º ‡¶´‡ßá‡¶∞‡¶æ‡¶®‡ßã ‡¶Ø‡¶æ‡¶¨‡ßá ‡¶®‡¶æ‡•§')) return;
  await updateDoc(doc(db,'users',uid), {status:'removed', updatedAt: serverTimestamp()});
  flash('mFlash','üóë ‡¶∏‡¶¶‡¶∏‡ßç‡¶Ø ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§');
  loadMembers();
};

// ‚îÄ‚îÄ VIEW MEMBER DETAIL
window.viewMember = async function(uid) {
  const snap = await getDoc(doc(db,'users',uid));
  if (!snap.exists()) return;
  const m = snap.data();
  const modal = document.getElementById('memberDetailModal');
  modal.style.display = 'flex';
  document.getElementById('memberDetailContent').innerHTML = `
    <div style="text-align:center;margin-bottom:16px">
      <div style="width:90px;height:90px;border-radius:50%;border:3px solid var(--gold);margin:0 auto 10px;overflow:hidden;background:var(--g3);display:flex;align-items:center;justify-content:center;font-size:2rem;font-weight:700;">
        ${m.photoUrl?`<img src="${m.photoUrl}" style="width:100%;height:100%;object-fit:cover">`:m.name?.charAt(0)||'?'}
      </div>
      <div style="color:var(--sgold);font-size:1.2rem;font-weight:700;">${m.name||'-'}</div>
      <span class="badge ${m.status==='approved'?'b-approved':'b-pending'}" style="margin-top:6px;display:inline-block">${m.status==='approved'?'‚úÖ ‡¶Ö‡¶®‡ßÅ‡¶Æ‡ßã‡¶¶‡¶ø‡¶§':'‚è≥ ‡¶™‡ßá‡¶®‡ßç‡¶°‡¶ø‡¶Ç'}</span>
      ${m.memberId?`<div style="color:var(--text2);font-size:12px;margin-top:4px">ID: ${m.memberId}</div>`:''}
    </div>
    <div style="display:grid;gap:8px">
      ${[['üìß ‡¶á‡¶Æ‡ßá‡¶á‡¶≤',m.email],['üìû ‡¶´‡ßã‡¶®',m.phone],['üìç ‡¶è‡¶≤‡¶æ‡¶ï‡¶æ',m.area],['ü©∏ ‡¶∞‡¶ï‡ßç‡¶§',m.bloodGroup],['‚ö§ ‡¶≤‡¶ø‡¶ô‡ßç‡¶ó',m.gender],['üéÇ ‡¶ú‡¶®‡ßç‡¶Æ',m.dob],['üè† ‡¶†‡¶ø‡¶ï‡¶æ‡¶®‡¶æ',m.address]].map(([k,v])=>
        v?`<div style="display:flex;gap:8px;padding:8px 12px;background:var(--glass);border:1px solid var(--b1);border-radius:8px;font-size:13px"><span>${k}</span><span style="margin-left:auto;color:var(--sgold)">${v}</span></div>`:''
      ).join('')}
    </div>
  `;
  document.getElementById('memberDetailActions').innerHTML = `
    ${m.phone?`<a class="btn btn-g" href="tel:${m.phone}" style="text-decoration:none">üìû ‡¶ï‡¶≤ ‡¶ï‡¶∞‡ßÅ‡¶®</a>`:''}
    ${m.phone?`<a class="btn btn-b" href="https://wa.me/880${m.phone.replace(/^0/,'').replace(/-/g,'')}" target="_blank" style="text-decoration:none">üí¨ WhatsApp</a>`:''}
    ${m.status==='pending'?`<button class="btn btn-g" onclick="approveUser('${uid}');document.getElementById('memberDetailModal').style.display='none'">‚úÖ ‡¶Ö‡¶®‡ßÅ‡¶Æ‡ßã‡¶¶‡¶®</button>`:''}
    ${m.status==='pending'?`<button class="btn btn-r" onclick="rejectUser('${uid}');document.getElementById('memberDetailModal').style.display='none'">‚ùå ‡¶™‡ßç‡¶∞‡¶§‡ßç‡¶Ø‡¶æ‡¶ñ‡ßç‡¶Ø‡¶æ‡¶®</button>`:''}
  `;
};

// ‚îÄ‚îÄ ADMIN MANAGEMENT
async function loadAdmins() {
  const snap = await getDocs(query(collection(db,'users'), where('role','in',['admin','superadmin'])));
  const list = snap.docs.map(d=>d.data());
  const tbody = document.getElementById('adminTableBody');
  if (!tbody) return;
  tbody.innerHTML = list.map(m=>`<tr>
    <td><div class="mem-info">
      <div class="mem-av">${m.photoUrl?`<img src="${m.photoUrl}" style="width:100%;height:100%;object-fit:cover;border-radius:50%">`:m.name?.charAt(0)||'?'}</div>
      <div><div class="mem-name">${m.name||'-'}</div></div>
    </div></td>
    <td>${m.email||'-'}</td>
    <td><span class="badge ${m.role==='superadmin'?'b-superadmin':'b-admin'}">${m.role==='superadmin'?'‚≠ê Super Admin':'üîë Admin'}</span></td>
    <td>${m.role==='superadmin'?'<span style="color:rgba(255,255,255,.3);font-size:12px">‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶® ‡¶ï‡¶∞‡¶æ ‡¶Ø‡¶æ‡¶¨‡ßá ‡¶®‡¶æ</span>':
      `<button class="btn btn-r" onclick="removeAdmin('${m.uid}')">Admin ‡¶∏‡¶∞‡¶æ‡¶®</button>`}</td>
  </tr>`).join('');
}

window.makeAdmin = async function() {
  const uid = document.getElementById('adminSelectMember').value;
  const role = document.getElementById('adminRole').value;
  if (!uid) { flash('aFlash','‚ö†Ô∏è ‡¶∏‡¶¶‡¶∏‡ßç‡¶Ø ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®‡•§','err'); return; }
  if (currentUserData?.role !== 'superadmin') { flash('aFlash','‚ùå ‡¶∂‡ßÅ‡¶ß‡ßÅ Super Admin ‡¶è‡¶á ‡¶ï‡¶æ‡¶ú ‡¶ï‡¶∞‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡¶¨‡ßá‡¶®‡•§','err'); return; }
  await updateDoc(doc(db,'users',uid), {role, updatedAt: serverTimestamp()});
  flash('aFlash','‚úÖ Admin ‡¶®‡¶ø‡¶Ø‡ßÅ‡¶ï‡ßç‡¶§ ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§');
  loadAdmins(); loadMembers();
};

window.removeAdmin = async function(uid) {
  if (!confirm('Admin ‡¶•‡ßá‡¶ï‡ßá ‡¶∏‡¶∞‡¶ø‡¶Ø‡¶º‡ßá ‡¶∏‡¶æ‡¶ß‡¶æ‡¶∞‡¶£ ‡¶∏‡¶¶‡¶∏‡ßç‡¶Ø ‡¶ï‡¶∞‡¶¨‡ßá‡¶®?')) return;
  await updateDoc(doc(db,'users',uid), {role:'member', updatedAt: serverTimestamp()});
  flash('aFlash','‚úÖ Admin ‡¶∏‡¶∞‡¶æ‡¶®‡ßã ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§');
  loadAdmins(); loadMembers();
};

// ‚îÄ‚îÄ NOTICES
async function loadNotices() {
  const snap = await getDocs(query(collection(db,'notices'), orderBy('createdAt','desc')));
  const list = snap.docs.map(d=>({...d.data(), id:d.id}));
  const el = document.getElementById('noticeList');
  if (!el) return;
  if (list.length===0) { el.innerHTML='<div class="empty"><div class="empty-ico">üì¢</div>‡¶ï‡ßã‡¶®‡ßã ‡¶®‡ßã‡¶ü‡¶ø‡¶∂ ‡¶®‡ßá‡¶á</div>'; return; }
  const typeColors={urgent:'#f44336',info:'#2196f3',success:'#4caf50',default:'var(--gold)'};
  el.innerHTML = list.map(n=>`<div class="notice-row">
    <div class="notice-type-dot" style="background:${typeColors[n.type]||typeColors.default}"></div>
    <div class="notice-content">
      <div class="notice-title">${n.title||'-'}</div>
      <div class="notice-body">${n.body||''}</div>
      <div class="notice-meta">üìÖ ${n.createdAt?.seconds?new Date(n.createdAt.seconds*1000).toLocaleDateString('bn-BD'):'-'} ¬∑ ${n.postedBy||'Admin'}</div>
    </div>
    ${n.photoUrl?`<img src="${n.photoUrl}" style="width:70px;height:70px;object-fit:cover;border-radius:8px;border:1px solid var(--b1)">` : ''}
    <div style="display:flex;flex-direction:column;gap:6px;margin-left:10px">
      <button class="btn btn-b" onclick="editNotice('${n.id}')">‚úèÔ∏è</button>
      <button class="btn btn-r" onclick="deleteNotice('${n.id}')">üóë</button>
    </div>
  </div>`).join('');
}

window.saveNotice = async function() {
  const title = document.getElementById('n-title').value.trim();
  const body = document.getElementById('n-body').value.trim();
  const type = document.getElementById('n-type').value;
  const editId = document.getElementById('editNoticeId').value;
  const photoFile = document.getElementById('n-photo').files[0];
  if (!title || !body) { alert('‡¶∂‡¶ø‡¶∞‡ßã‡¶®‡¶æ‡¶Æ ‡¶ì ‡¶¨‡¶ø‡¶¨‡¶∞‡¶£ ‡¶¶‡¶ø‡¶®‡•§'); return; }

  let photoUrl = null;
  if (photoFile) {
    const fd = new FormData();
    fd.append('file', photoFile);
    fd.append('upload_preset', UPLOAD_PRESET);
    fd.append('folder','somaj-kallyan/notices');
    const res = await fetch(CLOUDINARY_URL, {method:'POST',body:fd});
    const data = await res.json();
    photoUrl = data.secure_url;
  }

  const payload = {title, body, type, postedBy: currentUserData?.name||'Admin', updatedAt: serverTimestamp()};
  if (photoUrl) payload.photoUrl = photoUrl;

  if (editId) {
    await updateDoc(doc(db,'notices',editId), payload);
    flash('nFlash','‚úÖ ‡¶®‡ßã‡¶ü‡¶ø‡¶∂ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§');
  } else {
    payload.createdAt = serverTimestamp();
    await addDoc(collection(db,'notices'), payload);
    flash('nFlash','‚úÖ ‡¶®‡¶§‡ßÅ‡¶® ‡¶®‡ßã‡¶ü‡¶ø‡¶∂ ‡¶Ø‡ßã‡¶ó ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§');
  }
  document.getElementById('editNoticeId').value='';
  document.getElementById('n-title').value='';
  document.getElementById('n-body').value='';
  switchNoticeTab('list', document.querySelector('.ptab'));
  loadNotices();
};

window.editNotice = async function(id) {
  const snap = await getDoc(doc(db,'notices',id));
  if (!snap.exists()) return;
  const n = snap.data();
  document.getElementById('editNoticeId').value = id;
  document.getElementById('n-title').value = n.title||'';
  document.getElementById('n-body').value = n.body||'';
  document.getElementById('n-type').value = n.type||'default';
  document.getElementById('noticeFormTitle').textContent = '‚úèÔ∏è ‡¶®‡ßã‡¶ü‡¶ø‡¶∂ ‡¶∏‡¶Æ‡ßç‡¶™‡¶æ‡¶¶‡¶®‡¶æ';
  switchNoticeTab('add', document.querySelectorAll('.ptab')[1]);
};

window.deleteNotice = async function(id) {
  if (!confirm('‡¶è‡¶á ‡¶®‡ßã‡¶ü‡¶ø‡¶∂ ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶¨‡ßá‡¶®?')) return;
  await deleteDoc(doc(db,'notices',id));
  flash('nFlash','üóë ‡¶®‡ßã‡¶ü‡¶ø‡¶∂ ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§');
  loadNotices();
};

// ‚îÄ‚îÄ GALLERY
async function loadGallery() {
  const snap = await getDocs(query(collection(db,'gallery'), orderBy('createdAt','desc')));
  const list = snap.docs.map(d=>({...d.data(),id:d.id}));
  const el = document.getElementById('galAdminGrid');
  if (!el) return;
  if (list.length===0) { el.innerHTML='<div class="empty" style="grid-column:1/-1"><div class="empty-ico">üì∑</div>‡¶ï‡ßã‡¶®‡ßã ‡¶õ‡¶¨‡¶ø ‡¶®‡ßá‡¶á</div>'; return; }
  el.innerHTML = list.map(g=>`
    <div style="border-radius:12px;overflow:hidden;border:1px solid var(--b1);background:var(--glass);position:relative;">
      <img src="${g.src}" style="width:100%;height:140px;object-fit:cover;display:block">
      <div style="padding:10px">
        <div style="color:var(--sgold);font-size:12px;font-weight:600;margin-bottom:4px">${g.caption||'-'}</div>
        <div style="color:rgba(255,255,255,.4);font-size:11px">${g.cat||'-'}</div>
      </div>
      <button class="btn btn-r" onclick="deleteGalPhoto('${g.id}')" style="position:absolute;top:8px;right:8px;padding:4px 8px">üóë</button>
    </div>`).join('');
}

window.previewGalPhoto = function(input) {
  const wrap = document.getElementById('galPreviewWrap');
  if (input.files[0]) {
    const url = URL.createObjectURL(input.files[0]);
    wrap.innerHTML = `<img class="img-preview" src="${url}">`;
  }
};

window.uploadGalleryPhoto = async function() {
  const file = document.getElementById('g-photo').files[0];
  const caption = document.getElementById('g-caption').value.trim();
  const cat = document.getElementById('g-cat').value;
  if (!file || !caption) { alert('‡¶õ‡¶¨‡¶ø ‡¶ì ‡¶¨‡¶ø‡¶¨‡¶∞‡¶£ ‡¶¶‡¶ø‡¶®‡•§'); return; }
  const btn = event.target; btn.disabled=true; btn.textContent='‚è≥ ‡¶Ü‡¶™‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...';
  const fd = new FormData();
  fd.append('file',file); fd.append('upload_preset',UPLOAD_PRESET); fd.append('folder','somaj-kallyan/gallery');
  const res = await fetch(CLOUDINARY_URL,{method:'POST',body:fd});
  const data = await res.json();
  await addDoc(collection(db,'gallery'),{src:data.secure_url, caption, cat, uploadedBy:currentUserData?.name||'Admin', createdAt:serverTimestamp()});
  flash('gFlash','‚úÖ ‡¶õ‡¶¨‡¶ø ‡¶Ø‡ßã‡¶ó ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§');
  btn.disabled=false; btn.textContent='üì§ ‡¶Ü‡¶™‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡ßÅ‡¶®';
  document.getElementById('g-photo').value='';
  document.getElementById('g-caption').value='';
  document.getElementById('galPreviewWrap').innerHTML='';
  loadGallery();
  switchGalTab('list',document.querySelector('.ptab'));
};

window.deleteGalPhoto = async function(id) {
  if (!confirm('‡¶õ‡¶¨‡¶ø ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶¨‡ßá‡¶®?')) return;
  await deleteDoc(doc(db,'gallery',id));
  flash('gFlash','üóë ‡¶õ‡¶¨‡¶ø ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§');
  loadGallery();
};

// ‚îÄ‚îÄ STATS
async function loadStats() {
  const snap = await getDoc(doc(db,'config','stats'));
  if (!snap.exists()) return;
  const s = snap.data();
  const fields={members:'st-members',branches:'st-branches',activities:'st-activities',years:'st-years',students:'st-students',trees:'st-trees',blood:'st-blood',families:'st-families'};
  Object.entries(fields).forEach(([k,id])=>{ const el=document.getElementById(id); if(el&&s[k]) el.value=s[k]; });
}

window.saveStats = async function() {
  const fields={members:'st-members',branches:'st-branches',activities:'st-activities',years:'st-years',students:'st-students',trees:'st-trees',blood:'st-blood',families:'st-families'};
  const data={};
  Object.entries(fields).forEach(([k,id])=>{ const v=document.getElementById(id)?.value; if(v) data[k]=parseInt(v)||0; });
  await setDoc(doc(db,'config','stats'), {...data, updatedAt:serverTimestamp()});
  flash('stFlash','‚úÖ ‡¶™‡¶∞‡¶ø‡¶∏‡¶Ç‡¶ñ‡ßç‡¶Ø‡¶æ‡¶® ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§');
};

// ‚îÄ‚îÄ Logout
window.doLogout = function() { signOut(auth).then(()=>window.location.href='login.html'); };

// ‚îÄ‚îÄ Member tab switcher
window.switchMemberTab = function(tab, btn) {
  document.getElementById('memberListPanel').style.display = tab==='list' ? 'block' : 'none';
  document.getElementById('memberAddPanel').style.display = tab==='add' ? 'block' : 'none';
  document.querySelectorAll('#s-members .ptab').forEach(b=>b.classList.remove('active'));
  if(btn) btn.classList.add('active');
};

// ‚îÄ‚îÄ Photo preview for add member
window.previewAddMemberPhoto = function(input) {
  const wrap = document.getElementById('amPhotoPreview');
  if (input.files[0]) {
    const url = URL.createObjectURL(input.files[0]);
    wrap.innerHTML = `<img class="img-preview" src="${url}">`;
  }
};

// ‚îÄ‚îÄ Add Member by Admin (Firebase Auth + Firestore)
window.addMemberByAdmin = async function() {
  const name = document.getElementById('am-name').value.trim();
  const phone = document.getElementById('am-phone').value.trim();
  const email = document.getElementById('am-email').value.trim();
  const pass = document.getElementById('am-pass').value;
  const area = document.getElementById('am-area').value;
  const blood = document.getElementById('am-blood').value;
  const gender = document.getElementById('am-gender').value;
  const dob = document.getElementById('am-dob').value;
  const position = document.getElementById('am-position').value;
  const address = document.getElementById('am-address').value.trim();
  const photoFile = document.getElementById('am-photo').files[0];

  if (!name||!phone||!email||!pass||!area) {
    flash('addMemberFlash','‚ö†Ô∏è ‡¶®‡¶æ‡¶Æ, ‡¶´‡ßã‡¶®, ‡¶á‡¶Æ‡ßá‡¶á‡¶≤, ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶ì ‡¶è‡¶≤‡¶æ‡¶ï‡¶æ ‡¶Ü‡¶¨‡¶∂‡ßç‡¶Ø‡¶ø‡¶ï‡•§','err'); return;
  }
  if (pass.length < 6) { flash('addMemberFlash','‚ö†Ô∏è ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶ï‡¶Æ‡¶™‡¶ï‡ßç‡¶∑‡ßá ‡ß¨ ‡¶Ö‡¶ï‡ßç‡¶∑‡¶∞‡ßá‡¶∞ ‡¶π‡¶§‡ßá ‡¶π‡¶¨‡ßá‡•§','err'); return; }

  const btn = event.target; btn.disabled=true; btn.textContent='‚è≥ ‡¶Ø‡ßã‡¶ó ‡¶π‡¶ö‡ßç‡¶õ‡ßá...';

  try {
    // Upload photo if provided
    let photoUrl = '';
    if (photoFile) {
      btn.textContent = 'üì∏ ‡¶õ‡¶¨‡¶ø ‡¶Ü‡¶™‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...';
      const fd = new FormData();
      fd.append('file',photoFile); fd.append('upload_preset',UPLOAD_PRESET); fd.append('folder','somaj-kallyan/members');
      const res = await fetch(CLOUDINARY_URL,{method:'POST',body:fd});
      const data = await res.json();
      photoUrl = data.secure_url || '';
    }

    // Create Firebase Auth account
    btn.textContent = 'üîê ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü ‡¶§‡ßà‡¶∞‡¶ø ‡¶π‡¶ö‡ßç‡¶õ‡ßá...';
    const { createUserWithEmailAndPassword } = await import('https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js');
    const cred = await createUserWithEmailAndPassword(auth, email, pass);

    // Generate Member ID
    const year = new Date().getFullYear();
    const approvedSnap = await getDocs(query(collection(db,'users'),where('status','==','approved')));
    const serial = String(approvedSnap.size + 1).padStart(3,'0');
    const memberId = `${year}-${serial}`;

    // Save to Firestore
    const { setDoc } = await import('https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js');
    await setDoc(doc(db,'users',cred.user.uid), {
      uid: cred.user.uid,
      name, phone, area, email, photoUrl,
      bloodGroup: blood, gender, dob, address,
      role: 'member',
      status: 'approved',
      position: position || '‡¶∏‡¶¶‡¶∏‡ßç‡¶Ø',
      memberId,
      createdAt: serverTimestamp(),
      updatedAt: serverTimestamp(),
    });

    flash('addMemberFlash', `‚úÖ ‡¶∏‡¶¶‡¶∏‡ßç‡¶Ø ‡¶Ø‡ßã‡¶ó ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá! ID: ${memberId}`);
    // Clear form
    ['am-name','am-phone','am-email','am-pass','am-address'].forEach(id => {
      const el = document.getElementById(id); if(el) el.value='';
    });
    document.getElementById('amPhotoPreview').innerHTML = '';
    loadMembers(); loadDashboard();
  } catch(e) {
    const msg = e.code==='auth/email-already-in-use' ? '‚ùå ‡¶è‡¶á ‡¶á‡¶Æ‡ßá‡¶á‡¶≤‡ßá ‡¶Ü‡¶ó‡ßá‡¶á ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü ‡¶Ü‡¶õ‡ßá‡•§' : '‚ùå '+e.message;
    flash('addMemberFlash', msg, 'err');
  }
  btn.disabled=false; btn.textContent='‚úÖ ‡¶∏‡¶¶‡¶∏‡ßç‡¶Ø ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®';
};

// ‚îÄ‚îÄ Open Profile Edit (Super Admin only)
window.openProfileEdit = async function(uid) {
  if (currentUserData?.role !== 'superadmin') { alert('‡¶∂‡ßÅ‡¶ß‡ßÅ Super Admin ‡¶è‡¶á ‡¶ï‡¶æ‡¶ú ‡¶ï‡¶∞‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡¶¨‡ßá‡¶®‡•§'); return; }
  const snap = await getDoc(doc(db,'users',uid));
  if (!snap.exists()) return;
  const m = snap.data();
  document.getElementById('ep-uid').value = uid;
  document.getElementById('ep-name').value = m.name||'';
  document.getElementById('ep-phone').value = m.phone||'';
  document.getElementById('ep-area').value = m.area||'';
  document.getElementById('ep-blood').value = m.bloodGroup||'';
  document.getElementById('ep-position').value = m.position||'‡¶∏‡¶¶‡¶∏‡ßç‡¶Ø';
  document.getElementById('ep-dob').value = m.dob||'';
  document.getElementById('ep-address').value = m.address||'';
  document.getElementById('ep-memberid').value = m.memberId||'';
  document.getElementById('editProfileFlash').className = 'flash';
  document.getElementById('profileEditModal').style.display = 'flex';
};

// ‚îÄ‚îÄ Save Profile Edit
window.saveProfileEdit = async function() {
  const uid = document.getElementById('ep-uid').value;
  if (!uid) return;
  const name = document.getElementById('ep-name').value.trim();
  const phone = document.getElementById('ep-phone').value.trim();
  const area = document.getElementById('ep-area').value;
  const bloodGroup = document.getElementById('ep-blood').value;
  const position = document.getElementById('ep-position').value;
  const dob = document.getElementById('ep-dob').value;
  const address = document.getElementById('ep-address').value.trim();
  const memberId = document.getElementById('ep-memberid').value.trim();
  if (!name) { flash('editProfileFlash','‚ö†Ô∏è ‡¶®‡¶æ‡¶Æ ‡¶ñ‡¶æ‡¶≤‡¶ø ‡¶∞‡¶æ‡¶ñ‡¶æ ‡¶Ø‡¶æ‡¶¨‡ßá ‡¶®‡¶æ‡•§','err'); return; }
  try {
    const updates = { name, phone, area, bloodGroup, position, dob, address, updatedAt: serverTimestamp() };
    if (memberId) updates.memberId = memberId;
    await updateDoc(doc(db,'users',uid), updates);
    flash('editProfileFlash','‚úÖ ‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!');
    setTimeout(()=>{ document.getElementById('profileEditModal').style.display='none'; loadMembers(); }, 1200);
  } catch(e) { flash('editProfileFlash','‚ùå '+e.message,'err'); }
};

// ‚îÄ‚îÄ Helpers
function flash(id, msg, type='ok') {
  const el = document.getElementById(id);
  if (!el) return;
  el.textContent = msg;
  el.className = 'flash show flash-'+type;
  setTimeout(()=>el.classList.remove('show'),4000);
}
</script>

<script>
// ‚îÄ‚îÄ SECTION NAVIGATION
const sections = ['dashboard','pending','members','admins','notices','gallery','stats'];
const sectionTitles = {
  dashboard:'üìä ‡¶°‡ßç‡¶Ø‡¶æ‡¶∂‡¶¨‡ßã‡¶∞‡ßç‡¶°', pending:'‚è≥ ‡¶™‡ßá‡¶®‡ßç‡¶°‡¶ø‡¶Ç ‡¶Ü‡¶¨‡ßá‡¶¶‡¶®', members:'üë• ‡¶∏‡¶ï‡¶≤ ‡¶∏‡¶¶‡¶∏‡ßç‡¶Ø',
  admins:'üîë Admin ‡¶¨‡ßç‡¶Ø‡¶¨‡¶∏‡ßç‡¶•‡¶æ‡¶™‡¶®‡¶æ', notices:'üì¢ ‡¶®‡ßã‡¶ü‡¶ø‡¶∂', gallery:'üì∑ ‡¶ó‡ßç‡¶Ø‡¶æ‡¶≤‡¶æ‡¶∞‡¶ø', stats:'üìà ‡¶™‡¶∞‡¶ø‡¶∏‡¶Ç‡¶ñ‡ßç‡¶Ø‡¶æ‡¶®'
};

function goSection(id) {
  sections.forEach(s=>{
    const el=document.getElementById('s-'+s); if(el) el.style.display=s===id?'block':'none';
  });
  document.querySelectorAll('.nav-item').forEach(n=>n.classList.remove('active'));
  const navItems=document.querySelectorAll('.nav-item');
  navItems.forEach(n=>{if(n.getAttribute('onclick')?.includes("'"+id+"'")) n.classList.add('active');});
  document.getElementById('sectionTitle').textContent = sectionTitles[id]||id;
  closeSidebar();
}

function switchNoticeTab(tab, btn) {
  document.getElementById('noticeListPanel').style.display = tab==='list'?'block':'none';
  document.getElementById('noticeAddPanel').style.display = tab==='add'?'block':'none';
  document.querySelectorAll('#s-notices .ptab').forEach(b=>b.classList.remove('active'));
  if(btn) btn.classList.add('active');
}

function switchGalTab(tab, btn) {
  document.getElementById('galListPanel').style.display = tab==='list'?'block':'none';
  document.getElementById('galAddPanel').style.display = tab==='add'?'block':'none';
  document.querySelectorAll('#s-gallery .ptab').forEach(b=>b.classList.remove('active'));
  if(btn) btn.classList.add('active');
}

function openSidebar() {
  document.getElementById('sidebar').classList.add('open');
  document.getElementById('sidebarOverlay').classList.add('open');
}
function closeSidebar() {
  document.getElementById('sidebar').classList.remove('open');
  document.getElementById('sidebarOverlay').classList.remove('open');
}

// Clock
function updateClock() {
  const now = new Date();
  document.getElementById('currentTime').textContent = now.toLocaleTimeString('bn-BD');
}
setInterval(updateClock, 1000);
updateClock();
</script>
</body>
</html>